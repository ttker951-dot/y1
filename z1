-- 防通知篡改钩子
local old
old = hookmetamethod(game:GetService("StarterGui"), "__namecall", newcclosure(function(self, ...)
    local method = getnamecallmethod()
    local args = {...}
    if method == "SetCore" and args[1] == "SendNotification" then
        local options = args[2]
        if type(options) == "table" and 
           tostring(options.Title) == "人挤人" and 
           tostring(options.Text) == "人挤人" 
        then
            local modifiedOptions = table.clone(options)
            modifiedOptions.Text = "1"
            return old(self, "SetCore", "SendNotification", modifiedOptions)
        end
    end
    return old(self, ...)
end))

-- 加载提示
game:GetService("StarterGui"):SetCore("SendNotification",{
    Title = "人挤人中心",
    Text = "加载中",
    Duration = 5;
})
task.wait(0.1)

-- 服务初始化
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local Workspace = game:GetService("Workspace")
local LocalPlayer = Players.LocalPlayer
local Camera = Workspace.CurrentCamera

-- ========== 内嵌UI库开始 ==========
local library = {}
local ToggleUI = false
library.currentTab = nil
library.flags = {}
local services = setmetatable({}, {
    __index = function(t, k)
        return game.GetService(game, k)
    end,
})
local mouse = services.Players.LocalPlayer:GetMouse()

local TextColor = Color3.fromRGB(255, 255, 255)  
local PlaceholderColor = Color3.fromRGB(180, 180, 180)  
local DisabledTextColor = Color3.fromRGB(150, 150, 150) 

function Tween(obj, t, data)
    services.TweenService
        :Create(obj, TweenInfo.new(t[1], Enum.EasingStyle[t[2]], Enum.EasingDirection[t[3]]), data)
        :Play()
    return true
end

function Ripple(obj)
    spawn(function()
        if obj.ClipsDescendants ~= true then
            obj.ClipsDescendants = true
        end
        local Ripple = Instance.new("ImageLabel")
        Ripple.Name = "Ripple"
        Ripple.Parent = obj
        Ripple.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
        Ripple.BackgroundTransparency = 1.000
        Ripple.ZIndex = 8
        Ripple.Image = "rbxassetid://2708891598"
        Ripple.ImageTransparency = 0.800
        Ripple.ScaleType = Enum.ScaleType.Fit
        Ripple.ImageColor3 = Color3.fromRGB(255, 255, 255)
        Ripple.Position = UDim2.new(
            (mouse.X - Ripple.AbsolutePosition.X) / obj.AbsoluteSize.X,
            0,
            (mouse.Y - Ripple.AbsolutePosition.Y) / obj.AbsoluteSize.Y,
            0
        )
        Tween(
            Ripple,
            { 0.3, "Linear", "InOut" },
            { Position = UDim2.new(-5.5, 0, -5.5, 0), Size = UDim2.new(12, 0, 12, 0) }
        )
        wait(0.15)
        Tween(Ripple, { 0.3, "Linear", "InOut" }, { ImageTransparency = 1 })
        wait(0.3)
        Ripple:Destroy()
    end)
end

local toggled = false
local switchingTabs = false

function switchTab(new)
    if switchingTabs then
        return
    end
    local old = library.currentTab
    if old == nil then
        new[2].Visible = true
        library.currentTab = new
        services.TweenService:Create(new[1], TweenInfo.new(0.1), { ImageTransparency = 0 }):Play()
        services.TweenService:Create(new[1].TabText, TweenInfo.new(0.1), { TextTransparency = 0 }):Play()
        return
    end
    if old[1] == new[1] then
        return
    end
    switchingTabs = true
    library.currentTab = new
    services.TweenService:Create(old[1], TweenInfo.new(0.1), { ImageTransparency = 0.2 }):Play()
    services.TweenService:Create(new[1], TweenInfo.new(0.1), { ImageTransparency = 0 }):Play()
    services.TweenService:Create(old[1].TabText, TweenInfo.new(0.1), { TextTransparency = 0.2 }):Play()
    services.TweenService:Create(new[1].TabText, TweenInfo.new(0.1), { TextTransparency = 0 }):Play()
    old[2].Visible = false
    new[2].Visible = true
    task.wait(0.1)
    switchingTabs = false
end

function drag(frame, hold)
    if not hold then
        hold = frame
    end
    local dragging
    local dragInput
    local dragStart
    local startPos
    local function update(input)
        local delta = input.Position - dragStart
        frame.Position =
            UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
    end
    hold.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            dragging = true
            dragStart = input.Position
            startPos = frame.Position
            input.Changed:Connect(function()
                if input.UserInputState == Enum.UserInputState.End then
                    dragging = false
                end
            end)
        end
    end)
    frame.InputChanged:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseMovement then
            dragInput = input
        end
    end)
    services.UserInputService.InputChanged:Connect(function(input)
        if input == dragInput and dragging then
            update(input)
        end
    end)
end

function library.new(library, name, theme)
    for _, v in next, services.CoreGui:GetChildren() do
        if v.Name == "REN" then
            v:Destroy()
        end
    end
    
    -- ========== 统一使用半透明黑色主题 ==========
    MainColor = Color3.fromRGB(0, 0, 0)       -- 黑色主色调
    Background = Color3.fromRGB(0, 0, 0)      -- 黑色背景
    BackgroundTransparency = 0.5              -- 半透明效果
    zyColor = Color3.fromRGB(30, 30, 30)      -- 深灰色控件背景
    zyColorTransparency = 0.3                 -- 控件半透明
    beijingColor = Color3.fromRGB(255, 255, 255) -- 亮白色元素

    local dogent = Instance.new("ScreenGui")
    local Main = Instance.new("Frame")
    local TabMain = Instance.new("Frame")
    local MainC = Instance.new("UICorner")
    local SB = Instance.new("Frame")
    local SBC = Instance.new("UICorner")
    local Side = Instance.new("Frame")
    local SideG = Instance.new("UIGradient")
    local TabBtns = Instance.new("ScrollingFrame")
    local TabBtnsL = Instance.new("UIListLayout")
    local ScriptTitle = Instance.new("TextLabel")
    local SBG = Instance.new("UIGradient")
    local Open = Instance.new("TextButton")
    local UIG = Instance.new("UIGradient")
    local DropShadowHolder = Instance.new("Frame")
    local DropShadow = Instance.new("ImageLabel")
    local UICornerMain = Instance.new("UICorner")
    local UIGradient = Instance.new("UIGradient")
    local UIGradientTitle = Instance.new("UIGradient")
    
    if syn and syn.protect_gui then
        syn.protect_gui(dogent)
    end
    
    dogent.Name = "REN"
    dogent.Parent = services.CoreGui
    
    function UiDestroy()
        dogent:Destroy()
    end

function ToggleUILib()
    Main.Visible = not Main.Visible
end
    
    Main.Name = "Main"
    Main.Parent = dogent
    Main.AnchorPoint = Vector2.new(0.5, 0.5)
    Main.BackgroundColor3 = Background
    Main.BackgroundTransparency = BackgroundTransparency  -- 半透明效果
    Main.BorderColor3 = MainColor
    Main.Position = UDim2.new(0.5, 0, 0.5, 0)
    Main.Size = UDim2.new(0, 572, 0, 353)
    Main.ZIndex = 1
    Main.Active = true
    Main.Draggable = true
    
    services.UserInputService.InputEnded:Connect(function(input)
        if input.KeyCode == Enum.KeyCode.LeftControl then
            if Main.Visible == true then
                Main.Visible = false
            else
                Main.Visible = true
            end
        end
    end)
    
    drag(Main)
    UICornerMain.Parent = Main
    UICornerMain.CornerRadius = UDim.new(0, 3)
    
    DropShadowHolder.Name = "DropShadowHolder"
    DropShadowHolder.Parent = Main
    DropShadowHolder.BackgroundTransparency = 1.000
    DropShadowHolder.BorderSizePixel = 0
    DropShadowHolder.Size = UDim2.new(1, 0, 1, 0)
    DropShadowHolder.BorderColor3 = Color3.fromRGB(255, 255, 255)
    DropShadowHolder.ZIndex = 0
    
    DropShadow.Name = "DropShadow"
    DropShadow.Parent = DropShadowHolder
    DropShadow.AnchorPoint = Vector2.new(0.5, 0.5)
    DropShadow.BackgroundTransparency = 1.000
    DropShadow.BorderSizePixel = 0
    DropShadow.Position = UDim2.new(0.5, 0, 0.5, 0)
    DropShadow.Size = UDim2.new(1, 43, 1, 43)
    DropShadow.ZIndex = 0
    DropShadow.Image = "rbxassetid://6015897843"
    DropShadow.ImageColor3 = Color3.fromRGB(255, 255, 255)
    DropShadow.ImageTransparency = 0.500
    DropShadow.ScaleType = Enum.ScaleType.Slice
    DropShadow.SliceCenter = Rect.new(49, 49, 450, 450)
    
    UIGradient.Color = ColorSequence.new({
        ColorSequenceKeypoint.new(0.00, Color3.fromRGB(52, 152, 219)),  -- 浅蓝色
        ColorSequenceKeypoint.new(0.25, Color3.fromRGB(41, 128, 185)),  -- 中等蓝
        ColorSequenceKeypoint.new(0.50, Color3.fromRGB(31, 97, 141)),   -- 深蓝
        ColorSequenceKeypoint.new(0.75, Color3.fromRGB(21, 67, 96)),    -- 更深蓝
        ColorSequenceKeypoint.new(1.00, Color3.fromRGB(52, 152, 219))   -- 回到浅蓝
    })
    UIGradient.Parent = DropShadow
    
    local TweenService = game:GetService("TweenService")
    local tweeninfo = TweenInfo.new(7, Enum.EasingStyle.Linear, Enum.EasingDirection.In, -1)
    local tween = TweenService:Create(UIGradient, tweeninfo, { Rotation = 360 })
    tween:Play()
    
    function toggleui()
        toggled = not toggled
        spawn(function()
            if toggled then
                wait(0.3)
            end
        end)
        Tween(Main, { 0.3, "Sine", "InOut" }, { Size = UDim2.new(0, 609, 0, (toggled and 505 or 0)) })
    end
    
    TabMain.Name = "TabMain"
    TabMain.Parent = Main
    TabMain.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
    TabMain.BackgroundTransparency = 1.000
    TabMain.Position = UDim2.new(0.217000037, 0, 0, 3)
    TabMain.Size = UDim2.new(0, 448, 0, 353)
    
    MainC.CornerRadius = UDim.new(0, 5.5)
    MainC.Name = "MainC"
    MainC.Parent = Main
    
    SB.Name = "SB"
    SB.Parent = Main
    SB.BackgroundColor3 = Background
    SB.BackgroundTransparency = BackgroundTransparency  -- 半透明效果
    SB.BorderColor3 = MainColor
    SB.Size = UDim2.new(0, 8, 0, 353)
    
    SBC.CornerRadius = UDim.new(0, 6)
    SBC.Name = "SBC"
    SBC.Parent = SB
    
    Side.Name = "Side"
    Side.Parent = SB
    Side.BackgroundColor3 = Background
    Side.BackgroundTransparency = BackgroundTransparency  -- 半透明效果
    Side.BorderColor3 = Color3.fromRGB(255, 255, 255)
    Side.BorderSizePixel = 0
    Side.ClipsDescendants = true
    Side.Position = UDim2.new(1, 0, 0, 0)
    Side.Size = UDim2.new(0, 110, 0, 353)
    
    SideG.Color =
        ColorSequence.new({ ColorSequenceKeypoint.new(0.00, zyColor), ColorSequenceKeypoint.new(1.00, zyColor) })
    SideG.Rotation = 90
    SideG.Name = "SideG"
    SideG.Parent = Side
    
    TabBtns.Name = "TabBtns"
    TabBtns.Parent = Side
    TabBtns.Active = true
    TabBtns.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
    TabBtns.BackgroundTransparency = 1.000
    TabBtns.BorderSizePixel = 0
    TabBtns.Position = UDim2.new(0, 0, 0.0973535776, 0)
    TabBtns.Size = UDim2.new(0, 110, 0, 318)
    TabBtns.CanvasSize = UDim2.new(0, 0, 1, 0)
    TabBtns.ScrollBarThickness = 0
    
    TabBtnsL.Name = "TabBtnsL"
    TabBtnsL.Parent = TabBtns
    TabBtnsL.SortOrder = Enum.SortOrder.LayoutOrder
    TabBtnsL.Padding = UDim.new(0, 12)
    
    -- ========== 修改标题文本样式 ==========
    ScriptTitle.Name = "ScriptTitle"
    ScriptTitle.Parent = Side
    ScriptTitle.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
    ScriptTitle.BackgroundTransparency = 1.000
    ScriptTitle.Position = UDim2.new(0, 0, 0.00953488424, 0)
    ScriptTitle.Size = UDim2.new(0, 102, 0, 20)
    ScriptTitle.Font = Enum.Font.GothamBlack  -- 更粗的字体
    ScriptTitle.Text = name
    ScriptTitle.TextColor3 = TextColor  -- 亮白色
    ScriptTitle.TextSize = 16.000
    ScriptTitle.TextTransparency = 0
    ScriptTitle.TextScaled = true
    ScriptTitle.TextXAlignment = Enum.TextXAlignment.Left
    
    UIGradientTitle.Parent = ScriptTitle
    
    local function NPLHKB_fake_script()
        local script = Instance.new("LocalScript", ScriptTitle)
        local button = script.Parent
        local gradient = button.UIGradient
        local ts = game:GetService("TweenService")
        local ti = TweenInfo.new(1, Enum.EasingStyle.Linear, Enum.EasingDirection.Out)
        local offset = { Offset = Vector2.new(1, 0) }
        local create = ts:Create(gradient, ti, offset)
        local startingPos = Vector2.new(-1, 0)
        local list = {}
        local s, kpt = ColorSequence.new, ColorSequenceKeypoint.new
        local counter = 0
        local status = "down"
        gradient.Offset = startingPos
        local function rainbowColors()
            local sat, val = 255, 255
            for i = 1, 10 do
                local hue = i * 17
                table.insert(list, Color3.fromHSV(hue / 255, sat / 255, val / 255))
            end
        end
        rainbowColors()
        gradient.Color = s({ kpt(0, list[#list]), kpt(0.5, list[#list - 1]), kpt(1, list[#list - 2]) })
        counter = #list
        local function animate()
            create:Play()
            create.Completed:Wait()
            gradient.Offset = startingPos
            gradient.Rotation = 180
            if counter == #list - 1 and status == "down" then
                gradient.Color =
                    s({ kpt(0, gradient.Color.Keypoints[1].Value), kpt(0.5, list[#list]), kpt(1, list[1]) })
                counter = 1
                status = "up"
            elseif counter == #list and status == "down" then
                gradient.Color = s({ kpt(0, gradient.Color.Keypoints[1].Value), kpt(0.5, list[1]), kpt(1, list[2]) })
                counter = 2
                status = "up"
            elseif counter <= #list - 2 and status == "down" then
                gradient.Color = s({
                    kpt(0, gradient.Color.Keypoints[1].Value),
                    kpt(0.5, list[counter + 1]),
                    kpt(1, list[counter + 2]),
                })
                counter = counter + 2
                status = "up"
            end
            create:Play()
            create.Completed:Wait()
            gradient.Offset = startingPos
            gradient.Rotation = 0
            if counter == #list - 1 and status == "up" then
                gradient.Color =
                    s({ kpt(0, list[1]), kpt(0.5, list[#list]), kpt(1, gradient.Color.Keypoints[3].Value) })
                counter = 1
                status = "down"
            elseif counter == #list and status == "up" then
                gradient.Color = s({ kpt(0, list[2]), kpt(0.5, list[1]), kpt(1, gradient.Color.Keypoints[3].Value) })
                counter = 2
                status = "down"
            elseif counter <= #list - 2 and status == "up" then
                gradient.Color = s({
                    kpt(0, list[counter + 2]),
                    kpt(0.5, list[counter + 1]),
                    kpt(1, gradient.Color.Keypoints[3].Value),
                })
                counter = counter + 2
                status = "down"
            end
            animate()
        end
        animate()
    end
    coroutine.wrap(NPLHKB_fake_script)()
    
    SBG.Color =
        ColorSequence.new({ ColorSequenceKeypoint.new(0.00, zyColor), ColorSequenceKeypoint.new(1.00, zyColor) })
    SBG.Rotation = 90
    SBG.Name = "SBG"
    SBG.Parent = SB
    
    TabBtnsL:GetPropertyChangedSignal("AbsoluteContentSize"):Connect(function()
        TabBtns.CanvasSize = UDim2.new(0, 0, 0, TabBtnsL.AbsoluteContentSize.Y + 18)
    end)
    
    -- ========== 修改打开按钮文本样式 ==========
Open.Name = "Open"
Open.Parent = dogent
Open.BackgroundColor3 = Color3.fromRGB(0, 0, 0)
Open.BackgroundTransparency = BackgroundTransparency
Open.Position = UDim2.new(0.00829315186, 0, 0.31107837, 0)
Open.Size = UDim2.new(0, 61, 0, 32)
Open.Font = Enum.Font.GothamBold
Open.Text = "人挤人中心"
Open.TextColor3 = TextColor
Open.TextTransparency = 0
Open.TextSize = 14.000
Open.Active = true
Open.Draggable = true
Open.ZIndex = 100  -- 确保按钮不会被遮挡

UIG.Parent = Open

-- 修改点击事件：仅控制 Main 的显示/隐藏
Open.MouseButton1Click:Connect(function()
    Main.Visible = not Main.Visible
end)
    
    local window = {}
    
    function window.Tab(window, name, icon)
        local Tab = Instance.new("ScrollingFrame")
        local TabIco = Instance.new("ImageLabel")
        local TabText = Instance.new("TextLabel")
        local TabBtn = Instance.new("TextButton")
        local TabL = Instance.new("UIListLayout")
        
        Tab.Name = "Tab"
        Tab.Parent = TabMain
        Tab.Active = true
        Tab.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
        Tab.BackgroundTransparency = 1.000
        Tab.Size = UDim2.new(1, 0, 1, 0)
        Tab.ScrollBarThickness = 2
        Tab.Visible = false
        
        TabIco.Name = "TabIco"
        TabIco.Parent = TabBtns
        TabIco.BackgroundTransparency = 1.000
        TabIco.BorderSizePixel = 0
        TabIco.Size = UDim2.new(0, 24, 0, 24)
        TabIco.Image = ("rbxassetid://%s"):format((icon or 4370341699))
        TabIco.ImageTransparency = 0.2
        
        -- ========== 修改标签页文本样式 ==========
        TabText.Name = "TabText"
        TabText.Parent = TabIco
        TabText.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
        TabText.BackgroundTransparency = 1.000
        TabText.Position = UDim2.new(1.41666663, 0, 0, 0)
        TabText.Size = UDim2.new(0, 76, 0, 24)
        TabText.Font = Enum.Font.GothamSemibold
        TabText.Text = name
        TabText.TextColor3 = TextColor  -- 亮白色
        TabText.TextSize = 14.000
        TabText.TextTransparency = 0.2
        TabText.TextXAlignment = Enum.TextXAlignment.Left
        
        TabBtn.Name = "TabBtn"
        TabBtn.Parent = TabIco
        TabBtn.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
        TabBtn.BackgroundTransparency = 1.000
        TabBtn.BorderSizePixel = 0
        TabBtn.Size = UDim2.new(0, 110, 0, 24)
        TabBtn.AutoButtonColor = false
        TabBtn.Font = Enum.Font.SourceSans
        TabBtn.Text = ""
        TabBtn.TextColor3 = Color3.fromRGB(0, 0, 0)
        TabBtn.TextSize = 14.000
        
        TabL.Name = "TabL"
        TabL.Parent = Tab
        TabL.SortOrder = Enum.SortOrder.LayoutOrder
        TabL.Padding = UDim.new(0, 4)
        
        TabBtn.MouseButton1Click:Connect(function()
            spawn(function()
                Ripple(TabBtn)
            end)
            switchTab({ TabIco, Tab })
        end)
        
        if library.currentTab == nil then
            switchTab({ TabIco, Tab })
        end
        
        TabL:GetPropertyChangedSignal("AbsoluteContentSize"):Connect(function()
            Tab.CanvasSize = UDim2.new(0, 0, 0, TabL.AbsoluteContentSize.Y + 8)
        end)
        
        local tab = {}
        
        function tab.section(tab, name, TabVal)
            local Section = Instance.new("Frame")
            local SectionC = Instance.new("UICorner")
            local SectionText = Instance.new("TextLabel")
            local SectionOpen = Instance.new("ImageLabel")
            local SectionOpened = Instance.new("ImageLabel")
            local SectionToggle = Instance.new("ImageButton")
            local Objs = Instance.new("Frame")
            local ObjsL = Instance.new("UIListLayout")
            
            Section.Name = "Section"
            Section.Parent = Tab
            Section.BackgroundColor3 = zyColor
            Section.BackgroundTransparency = zyColorTransparency  -- 半透明效果
            Section.BorderSizePixel = 0
            Section.ClipsDescendants = true
            Section.Size = UDim2.new(0.981000006, 0, 0, 36)
            
            SectionC.CornerRadius = UDim.new(0, 6)
            SectionC.Name = "SectionC"
            SectionC.Parent = Section
            
            -- ========== 修改区域标题文本样式 ==========
            SectionText.Name = "SectionText"
            SectionText.Parent = Section
            SectionText.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
            SectionText.BackgroundTransparency = 1.000
            SectionText.Position = UDim2.new(0.0887396261, 0, 0, 0)
            SectionText.Size = UDim2.new(0, 401, 0, 36)
            SectionText.Font = Enum.Font.GothamBold  -- 更粗的字体
            SectionText.Text = name
            SectionText.TextColor3 = TextColor  -- 亮白色
            SectionText.TextSize = 16.000
            SectionText.TextTransparency = 0
            SectionText.TextXAlignment = Enum.TextXAlignment.Left
            
            SectionOpen.Name = "SectionOpen"
            SectionOpen.Parent = SectionText
            SectionOpen.BackgroundTransparency = 1
            SectionOpen.BorderSizePixel = 0
            SectionOpen.Position = UDim2.new(0, -33, 0, 5)
            SectionOpen.Size = UDim2.new(0, 26, 0, 26)
            SectionOpen.Image = "http://www.roblox.com/asset/?id=6031302934"
            
            SectionOpened.Name = "SectionOpened"
            SectionOpened.Parent = SectionOpen
            SectionOpened.BackgroundTransparency = 1.000
            SectionOpened.BorderSizePixel = 0
            SectionOpened.Size = UDim2.new(0, 26, 0, 26)
            SectionOpened.Image = "http://www.roblox.com/asset/?id=6031302932"
            SectionOpened.ImageTransparency = 1.000
            
            SectionToggle.Name = "SectionToggle"
            SectionToggle.Parent = SectionOpen
            SectionToggle.BackgroundTransparency = 1
            SectionToggle.BorderSizePixel = 0
            SectionToggle.Size = UDim2.new(0, 26, 0, 26)
            
            Objs.Name = "Objs"
            Objs.Parent = Section
            Objs.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
            Objs.BackgroundTransparency = 1
            Objs.BorderSizePixel = 0
            Objs.Position = UDim2.new(0, 6, 0, 36)
            Objs.Size = UDim2.new(0.986347735, 0, 0, 0)
            
            ObjsL.Name = "ObjsL"
            ObjsL.Parent = Objs
            ObjsL.SortOrder = Enum.SortOrder.LayoutOrder
            ObjsL.Padding = UDim.new(0, 8)
            
            local open = TabVal
            if TabVal ~= false then
                Section.Size = UDim2.new(0.981000006, 0, 0, open and 36 + ObjsL.AbsoluteContentSize.Y + 8 or 36)
                SectionOpened.ImageTransparency = (open and 0 or 1)
                SectionOpen.ImageTransparency = (open and 1 or 0)
            end
            
            SectionToggle.MouseButton1Click:Connect(function()
                open = not open
                Section.Size = UDim2.new(0.981000006, 0, 0, open and 36 + ObjsL.AbsoluteContentSize.Y + 8 or 36)
                SectionOpened.ImageTransparency = (open and 0 or 1)
                SectionOpen.ImageTransparency = (open and 1 or 0)
            end)
            
            ObjsL:GetPropertyChangedSignal("AbsoluteContentSize"):Connect(function()
                if not open then
                    return
                end
                Section.Size = UDim2.new(0.981000006, 0, 0, 36 + ObjsL.AbsoluteContentSize.Y + 8)
            end)
            
            local section = {}
            
            function section.Button(section, text, callback)
                local callback = callback or function() end
                local BtnModule = Instance.new("Frame")
                local Btn = Instance.new("TextButton")
                local BtnC = Instance.new("UICorner")
                
                BtnModule.Name = "BtnModule"
                BtnModule.Parent = Objs
                BtnModule.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
                BtnModule.BackgroundTransparency = 1.000
                BtnModule.BorderSizePixel = 0
                BtnModule.Position = UDim2.new(0, 0, 0, 0)
                BtnModule.Size = UDim2.new(0, 428, 0, 38)
                
                -- ========== 修改按钮文本样式 ==========
                Btn.Name = "Btn"
                Btn.Parent = BtnModule
                Btn.BackgroundColor3 = zyColor
                Btn.BackgroundTransparency = zyColorTransparency  -- 半透明效果
                Btn.BorderSizePixel = 0
                Btn.Size = UDim2.new(0, 428, 0, 38)
                Btn.AutoButtonColor = false
                Btn.Font = Enum.Font.GothamBold  -- 更粗的字体
                Btn.Text = "   " .. text
                Btn.TextColor3 = TextColor  -- 亮白色
                Btn.TextSize = 16.000
                Btn.TextTransparency = 0
                Btn.TextXAlignment = Enum.TextXAlignment.Left
                
                BtnC.CornerRadius = UDim.new(0, 6)
                BtnC.Name = "BtnC"
                BtnC.Parent = Btn
                
                Btn.MouseButton1Click:Connect(function()
                    spawn(function()
                        Ripple(Btn)
                    end)
                    spawn(callback)
                end)
            end
            
            function section:Label(text)
                local LabelModule = Instance.new("Frame")
                local TextLabel = Instance.new("TextLabel")
                local LabelC = Instance.new("UICorner")
                
                LabelModule.Name = "LabelModule"
                LabelModule.Parent = Objs
                LabelModule.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
                LabelModule.BackgroundTransparency = 1.000
                LabelModule.BorderSizePixel = 0
                LabelModule.Position = UDim2.new(0, 0, NAN, 0)
                LabelModule.Size = UDim2.new(0, 428, 0, 19)
                
                -- ========== 修改标签文本样式 ==========
                TextLabel.Parent = LabelModule
                TextLabel.BackgroundColor3 = zyColor
                TextLabel.BackgroundTransparency = zyColorTransparency  -- 半透明效果
                TextLabel.Size = UDim2.new(0, 428, 0, 22)
                TextLabel.Font = Enum.Font.GothamBold  -- 更粗的字体
                TextLabel.Text = text
                TextLabel.TextColor3 = TextColor  -- 亮白色
                TextLabel.TextSize = 14.000
                TextLabel.TextTransparency = 0
                
                LabelC.CornerRadius = UDim.new(0, 6)
                LabelC.Name = "LabelC"
                LabelC.Parent = TextLabel
                
                return TextLabel
            end
            
            function section.Toggle(section, text, flag, enabled, callback)
                local callback = callback or function() end
                local enabled = enabled or false
                assert(text, "No text provided")
                assert(flag, "No flag provided")
                library.flags[flag] = enabled
                
                local ToggleModule = Instance.new("Frame")
                local ToggleBtn = Instance.new("TextButton")
                local ToggleBtnC = Instance.new("UICorner")
                local ToggleDisable = Instance.new("Frame")
                local ToggleSwitch = Instance.new("Frame")
                local ToggleSwitchC = Instance.new("UICorner")
                local ToggleDisableC = Instance.new("UICorner")
                
                ToggleModule.Name = "ToggleModule"
                ToggleModule.Parent = Objs
                ToggleModule.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
                ToggleModule.BackgroundTransparency = 1.000
                ToggleModule.BorderSizePixel = 0
                ToggleModule.Position = UDim2.new(0, 0, 0, 0)
                ToggleModule.Size = UDim2.new(0, 428, 0, 38)
                
                -- ========== 修改开关文本样式 ==========
                ToggleBtn.Name = "ToggleBtn"
                ToggleBtn.Parent = ToggleModule
                ToggleBtn.BackgroundColor3 = zyColor
                ToggleBtn.BackgroundTransparency = zyColorTransparency  -- 半透明效果
                ToggleBtn.BorderSizePixel = 0
                ToggleBtn.Size = UDim2.new(0, 428, 0, 38)
                ToggleBtn.AutoButtonColor = false
                ToggleBtn.Font = Enum.Font.GothamBold  -- 更粗的字体
                ToggleBtn.Text = "   " .. text
                ToggleBtn.TextColor3 = TextColor  -- 亮白色
                ToggleBtn.TextSize = 16.000
                ToggleBtn.TextTransparency = 0
                ToggleBtn.TextXAlignment = Enum.TextXAlignment.Left
                
                ToggleBtnC.CornerRadius = UDim.new(0, 6)
                ToggleBtnC.Name = "ToggleBtnC"
                ToggleBtnC.Parent = ToggleBtn
                
                ToggleDisable.Name = "ToggleDisable"
                ToggleDisable.Parent = ToggleBtn
                ToggleDisable.BackgroundColor3 = Background
                ToggleDisable.BackgroundTransparency = BackgroundTransparency  -- 半透明效果
                ToggleDisable.BorderSizePixel = 0
                ToggleDisable.Position = UDim2.new(0.901869178, 0, 0.208881587, 0)
                ToggleDisable.Size = UDim2.new(0, 36, 0, 22)
                
                ToggleSwitch.Name = "ToggleSwitch"
                ToggleSwitch.Parent = ToggleDisable
                ToggleSwitch.BackgroundColor3 = beijingColor
                ToggleSwitch.Size = UDim2.new(0, 24, 0, 22)
                
                ToggleSwitchC.CornerRadius = UDim.new(0, 6)
                ToggleSwitchC.Name = "ToggleSwitchC"
                ToggleSwitchC.Parent = ToggleSwitch
                
                ToggleDisableC.CornerRadius = UDim.new(0, 6)
                ToggleDisableC.Name = "ToggleDisableC"
                ToggleDisableC.Parent = ToggleDisable
                
                local funcs = {
                    SetState = function(self, state)
                        if state == nil then
                            state = not library.flags[flag]
                        end
                        if library.flags[flag] == state then
                            return
                        end
                        services.TweenService
                            :Create(
                                ToggleSwitch,
                                TweenInfo.new(0.2),
                                {
                                    Position = UDim2.new(0, (state and ToggleSwitch.Size.X.Offset / 2 or 0), 0, 0),
                                    BackgroundColor3 = (state and Color3.fromRGB(255, 255, 255) or beijingColor),
                                }
                            )
                            :Play()
                        library.flags[flag] = state
                        callback(state)
                    end,
                    Module = ToggleModule,
                }
                
                if enabled ~= false then
                    funcs:SetState(flag, true)
                end
                
                ToggleBtn.MouseButton1Click:Connect(function()
                    funcs:SetState()
                end)
                
                return funcs
            end
            
            function section.Keybind(section, text, default, callback)
                local callback = callback or function() end
                assert(text, "No text provided")
                assert(default, "No default key provided")
                local default = (typeof(default) == "string" and Enum.KeyCode[default] or default)
                local banned = {
                    Return = true,
                    Space = true,
                    Tab = true,
                    Backquote = true,
                    CapsLock = true,
                    Escape = true,
                    Unknown = true,
                }
                local shortNames = {
                    RightControl = "Right Ctrl",
                    LeftControl = "Left Ctrl",
                    LeftShift = "Left Shift",
                    RightShift = "Right Shift",
                    Semicolon = ";",
                    Quote = '"',
                    LeftBracket = "[",
                    RightBracket = "]",
                    Equals = "=",
                    Minus = "-",
                    RightAlt = "Right Alt",
                    LeftAlt = "Left Alt",
                }
                local bindKey = default
                local keyTxt = (default and (shortNames[default.Name] or default.Name) or "None")
                
                local KeybindModule = Instance.new("Frame")
                local KeybindBtn = Instance.new("TextButton")
                local KeybindBtnC = Instance.new("UICorner")
                local KeybindValue = Instance.new("TextButton")
                local KeybindValueC = Instance.new("UICorner")
                local KeybindL = Instance.new("UIListLayout")
                local UIPadding = Instance.new("UIPadding")
                
                KeybindModule.Name = "KeybindModule"
                KeybindModule.Parent = Objs
                KeybindModule.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
                KeybindModule.BackgroundTransparency = 1.000
                KeybindModule.BorderSizePixel = 0
                KeybindModule.Position = UDim2.new(0, 0, 0, 0)
                KeybindModule.Size = UDim2.new(0, 428, 0, 38)
                
                -- ========== 修改按键绑定文本样式 ==========
                KeybindBtn.Name = "KeybindBtn"
                KeybindBtn.Parent = KeybindModule
                KeybindBtn.BackgroundColor3 = zyColor
                KeybindBtn.BackgroundTransparency = zyColorTransparency  -- 半透明效果
                KeybindBtn.BorderSizePixel = 0
                KeybindBtn.Size = UDim2.new(0, 428, 0, 38)
                KeybindBtn.AutoButtonColor = false
                KeybindBtn.Font = Enum.Font.GothamBold  -- 更粗的字体
                KeybindBtn.Text = "   " .. text
                KeybindBtn.TextColor3 = TextColor  -- 亮白色
                KeybindBtn.TextSize = 16.000
                KeybindBtn.TextTransparency = 0
                KeybindBtn.TextXAlignment = Enum.TextXAlignment.Left
                
                KeybindBtnC.CornerRadius = UDim.new(0, 6)
                KeybindBtnC.Name = "KeybindBtnC"
                KeybindBtnC.Parent = KeybindBtn
                
                -- ========== 修改按键值文本样式 ==========
                KeybindValue.Name = "KeybindValue"
                KeybindValue.Parent = KeybindBtn
                KeybindValue.BackgroundColor3 = Background
                KeybindValue.BackgroundTransparency = BackgroundTransparency  -- 半透明效果
                KeybindValue.BorderSizePixel = 0
                KeybindValue.Position = UDim2.new(0.763033211, 0, 0.289473683, 0)
                KeybindValue.Size = UDim2.new(0, 100, 0, 28)
                KeybindValue.AutoButtonColor = false
                KeybindValue.Font = Enum.Font.GothamBold  -- 更粗的字体
                KeybindValue.Text = keyTxt
                KeybindValue.TextColor3 = TextColor  -- 亮白色
                KeybindValue.TextSize = 14.000
                KeybindValue.TextTransparency = 0
                
                KeybindValueC.CornerRadius = UDim.new(0, 6)
                KeybindValueC.Name = "KeybindValueC"
                KeybindValueC.Parent = KeybindValue
                
                KeybindL.Name = "KeybindL"
                KeybindL.Parent = KeybindBtn
                KeybindL.HorizontalAlignment = Enum.HorizontalAlignment.Right
                KeybindL.SortOrder = Enum.SortOrder.LayoutOrder
                KeybindL.VerticalAlignment = Enum.VerticalAlignment.Center
                
                UIPadding.Parent = KeybindBtn
                UIPadding.PaddingRight = UDim.new(0, 6)
                
                services.UserInputService.InputBegan:Connect(function(inp, gpe)
                    if gpe then
                        return
                    end
                    if inp.UserInputType ~= Enum.UserInputType.Keyboard then
                        return
                    end
                    if inp.KeyCode ~= bindKey then
                        return
                    end
                    callback(bindKey.Name)
                end)
                
                KeybindValue.MouseButton1Click:Connect(function()
                    KeybindValue.Text = "..."
                    wait()
                    local key, uwu = services.UserInputService.InputEnded:Wait()
                    local keyName = tostring(key.KeyCode.Name)
                    if key.UserInputType ~= Enum.UserInputType.Keyboard then
                        KeybindValue.Text = keyTxt
                        return
                    end
                    if banned[keyName] then
                        KeybindValue.Text = keyTxt
                        return
                    end
                    wait()
                    bindKey = Enum.KeyCode[keyName]
                    KeybindValue.Text = shortNames[keyName] or keyName
                end)
                
                KeybindValue:GetPropertyChangedSignal("TextBounds"):Connect(function()
                    KeybindValue.Size = UDim2.new(0, KeybindValue.TextBounds.X + 30, 0, 28)
                end)
                
                KeybindValue.Size = UDim2.new(0, KeybindValue.TextBounds.X + 30, 0, 28)
            end
            
            function section.Textbox(section, text, flag, default, callback)
                local callback = callback or function() end
                assert(text, "No text provided")
                assert(flag, "No flag provided")
                assert(default, "No default text provided")
                library.flags[flag] = default
                
                local TextboxModule = Instance.new("Frame")
                local TextboxBack = Instance.new("TextButton")
                local TextboxBackC = Instance.new("UICorner")
                local BoxBG = Instance.new("TextButton")
                local BoxBGC = Instance.new("UICorner")
                local TextBox = Instance.new("TextBox")
                local TextboxBackL = Instance.new("UIListLayout")
                local TextboxBackP = Instance.new("UIPadding")
                
                TextboxModule.Name = "TextboxModule"
                TextboxModule.Parent = Objs
                TextboxModule.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
                TextboxModule.BackgroundTransparency = 1.000
                TextboxModule.BorderSizePixel = 0
                TextboxModule.Position = UDim2.new(0, 0, 0, 0)
                TextboxModule.Size = UDim2.new(0, 428, 0, 38)
                
                -- ========== 修改文本框背景文本样式 ==========
                TextboxBack.Name = "TextboxBack"
                TextboxBack.Parent = TextboxModule
                TextboxBack.BackgroundColor3 = zyColor
                TextboxBack.BackgroundTransparency = zyColorTransparency  -- 半透明效果
                TextboxBack.BorderSizePixel = 0
                TextboxBack.Size = UDim2.new(0, 428, 0, 38)
                TextboxBack.AutoButtonColor = false
                TextboxBack.Font = Enum.Font.GothamBold  -- 更粗的字体
                TextboxBack.Text = "   " .. text
                TextboxBack.TextColor3 = TextColor  -- 亮白色
                TextboxBack.TextSize = 16.000
                TextboxBack.TextTransparency = 0
                TextboxBack.TextXAlignment = Enum.TextXAlignment.Left
                
                TextboxBackC.CornerRadius = UDim.new(0, 6)
                TextboxBackC.Name = "TextboxBackC"
                TextboxBackC.Parent = TextboxBack
                
                BoxBG.Name = "BoxBG"
                BoxBG.Parent = TextboxBack
                BoxBG.BackgroundColor3 = Background
                BoxBG.BackgroundTransparency = BackgroundTransparency  -- 半透明效果
                BoxBG.BorderSizePixel = 0
                BoxBG.Position = UDim2.new(0.763033211, 0, 0.289473683, 0)
                BoxBG.Size = UDim2.new(0, 100, 0, 28)
                BoxBG.AutoButtonColor = false
                BoxBG.Font = Enum.Font.Gotham
                BoxBG.Text = ""
                BoxBG.TextColor3 = Color3.fromRGB(255, 255, 255)
                BoxBG.TextSize = 14.000
                
                BoxBGC.CornerRadius = UDim.new(0, 6)
                BoxBGC.Name = "BoxBGC"
                BoxBGC.Parent = BoxBG
                
                -- ========== 修改输入框文本样式 ==========
                TextBox.Parent = BoxBG
                TextBox.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
                TextBox.BackgroundTransparency = 1.000
                TextBox.BorderSizePixel = 0
                TextBox.Size = UDim2.new(1, 0, 1, 0)
                TextBox.Font = Enum.Font.GothamBold  -- 更粗的字体
                TextBox.Text = default
                TextBox.TextColor3 = TextColor  -- 亮白色
                TextBox.PlaceholderColor3 = PlaceholderColor
                TextBox.TextSize = 14.000
                TextBox.TextTransparency = 0
                
                TextboxBackL.Name = "TextboxBackL"
                TextboxBackL.Parent = TextboxBack
                TextboxBackL.HorizontalAlignment = Enum.HorizontalAlignment.Right
                TextboxBackL.SortOrder = Enum.SortOrder.LayoutOrder
                TextboxBackL.VerticalAlignment = Enum.VerticalAlignment.Center
                
                TextboxBackP.Name = "TextboxBackP"
                TextboxBackP.Parent = TextboxBack
                TextboxBackP.PaddingRight = UDim.new(0, 6)
                
                TextBox.FocusLost:Connect(function()
                    if TextBox.Text == "" then
                        TextBox.Text = default
                    end
                    library.flags[flag] = TextBox.Text
                    callback(TextBox.Text)
                end)
                
                TextBox:GetPropertyChangedSignal("TextBounds"):Connect(function()
                    BoxBG.Size = UDim2.new(0, TextBox.TextBounds.X + 30, 0, 28)
                end)
                
                BoxBG.Size = UDim2.new(0, TextBox.TextBounds.X + 30, 0, 28)
            end
            
            function section.Slider(section, text, flag, default, min, max, precise, callback)
                local callback = callback or function() end
                local min = min or 1
                local max = max or 10
                local default = default or min
                local precise = precise or false
                library.flags[flag] = default
                assert(text, "No text provided")
                assert(flag, "No flag provided")
                assert(default, "No default value provided")
                
                local SliderModule = Instance.new("Frame")
                local SliderBack = Instance.new("TextButton")
                local SliderBackC = Instance.new("UICorner")
                local SliderBar = Instance.new("Frame")
                local SliderBarC = Instance.new("UICorner")
                local SliderPart = Instance.new("Frame")
                local SliderPartC = Instance.new("UICorner")
                local SliderValBG = Instance.new("TextButton")
                local SliderValBGC = Instance.new("UICorner")
                local SliderValue = Instance.new("TextBox")
                local MinSlider = Instance.new("TextButton")
                local AddSlider = Instance.new("TextButton")
                
                SliderModule.Name = "SliderModule"
                SliderModule.Parent = Objs
                SliderModule.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
                SliderModule.BackgroundTransparency = 1.000
                SliderModule.BorderSizePixel = 0
                SliderModule.Position = UDim2.new(0, 0, 0, 0)
                SliderModule.Size = UDim2.new(0, 428, 0, 38)
                
                -- ========== 修改滑块文本样式 ==========
                SliderBack.Name = "SliderBack"
                SliderBack.Parent = SliderModule
                SliderBack.BackgroundColor3 = zyColor
                SliderBack.BackgroundTransparency = zyColorTransparency  -- 半透明效果
                SliderBack.BorderSizePixel = 0
                SliderBack.Size = UDim2.new(0, 428, 0, 38)
                SliderBack.AutoButtonColor = false
                SliderBack.Font = Enum.Font.GothamBold  -- 更粗的字体
                SliderBack.Text = "   " .. text
                SliderBack.TextColor3 = TextColor  -- 亮白色
                SliderBack.TextSize = 16.000
                SliderBack.TextTransparency = 0
                SliderBack.TextXAlignment = Enum.TextXAlignment.Left
                
                SliderBackC.CornerRadius = UDim.new(0, 6)
                SliderBackC.Name = "SliderBackC"
                SliderBackC.Parent = SliderBack
                
                SliderBar.Name = "SliderBar"
                SliderBar.Parent = SliderBack
                SliderBar.AnchorPoint = Vector2.new(0, 0.5)
                SliderBar.BackgroundColor3 = Background
                SliderBar.BackgroundTransparency = BackgroundTransparency  -- 半透明效果
                SliderBar.BorderSizePixel = 0
                SliderBar.Position = UDim2.new(0.369000018, 40, 0.5, 0)
                SliderBar.Size = UDim2.new(0, 140, 0, 12)
                
                SliderBarC.CornerRadius = UDim.new(0, 4)
                SliderBarC.Name = "SliderBarC"
                SliderBarC.Parent = SliderBar
                
                SliderPart.Name = "SliderPart"
                SliderPart.Parent = SliderBar
                SliderPart.BackgroundColor3 = beijingColor
                SliderPart.Size = UDim2.new(0, 54, 0, 13)
                
                SliderPartC.CornerRadius = UDim.new(0, 4)
                SliderPartC.Name = "SliderPartC"
                SliderPartC.Parent = SliderPart
                
                -- ========== 修改滑块值文本样式 ==========
                SliderValBG.Name = "SliderValBG"
                SliderValBG.Parent = SliderBack
                SliderValBG.BackgroundColor3 = Background
                SliderValBG.BackgroundTransparency = BackgroundTransparency  -- 半透明效果
                SliderValBG.BorderSizePixel = 0
                SliderValBG.Position = UDim2.new(0.883177578, 0, 0.131578952, 0)
                SliderValBG.Size = UDim2.new(0, 44, 0, 28)
                SliderValBG.AutoButtonColor = false
                SliderValBG.Font = Enum.Font.Gotham
                SliderValBG.Text = ""
                SliderValBG.TextColor3 = Color3.fromRGB(255, 255, 255)
                SliderValBG.TextSize = 14.000
                
                SliderValBGC.CornerRadius = UDim.new(0, 6)
                SliderValBGC.Name = "SliderValBGC"
                SliderValBGC.Parent = SliderValBG
                
                SliderValue.Name = "SliderValue"
                SliderValue.Parent = SliderValBG
                SliderValue.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
                SliderValue.BackgroundTransparency = 1.000
                SliderValue.BorderSizePixel = 0
                SliderValue.Size = UDim2.new(1, 0, 1, 0)
                SliderValue.Font = Enum.Font.GothamBold  -- 更粗的字体
                SliderValue.Text = "1000"
                SliderValue.TextColor3 = TextColor  -- 亮白色
                SliderValue.TextSize = 14.000
                SliderValue.TextTransparency = 0
                
                -- ========== 修改加减按钮文本样式 ==========
                MinSlider.Name = "MinSlider"
                MinSlider.Parent = SliderModule
                MinSlider.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
                MinSlider.BackgroundTransparency = 1.000
                MinSlider.BorderSizePixel = 0
                MinSlider.Position = UDim2.new(0.296728969, 40, 0.236842096, 0)
                MinSlider.Size = UDim2.new(0, 20, 0, 20)
                MinSlider.Font = Enum.Font.GothamBold  -- 更粗的字体
                MinSlider.Text = "-"
                MinSlider.TextColor3 = TextColor  -- 亮白色
                MinSlider.TextSize = 24.000
                MinSlider.TextTransparency = 0
                MinSlider.TextWrapped = true
                
                AddSlider.Name = "AddSlider"
                AddSlider.Parent = SliderModule
                AddSlider.AnchorPoint = Vector2.new(0, 0.5)
                AddSlider.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
                AddSlider.BackgroundTransparency = 1.000
                AddSlider.BorderSizePixel = 0
                AddSlider.Position = UDim2.new(0.810906529, 0, 0.5, 0)
                AddSlider.Size = UDim2.new(0, 20, 0, 20)
                AddSlider.Font = Enum.Font.GothamBold  -- 更粗的字体
                AddSlider.Text = "+"
                AddSlider.TextColor3 = TextColor  -- 亮白色
                AddSlider.TextSize = 24.000
                AddSlider.TextTransparency = 0
                AddSlider.TextWrapped = true
                
                local funcs = {
                    SetValue = function(self, value)
                        local percent = (mouse.X - SliderBar.AbsolutePosition.X) / SliderBar.AbsoluteSize.X
                        if value then
                            percent = (value - min) / (max - min)
                        end
                        percent = math.clamp(percent, 0, 1)
                        if precise then
                            value = value or tonumber(string.format("%.1f", tostring(min + (max - min) * percent)))
                        else
                            value = value or math.floor(min + (max - min) * percent)
                        end
                        library.flags[flag] = tonumber(value)
                        SliderValue.Text = tostring(value)
                        SliderPart.Size = UDim2.new(percent, 0, 1, 0)
                        callback(tonumber(value))
                    end,
                }
                
                MinSlider.MouseButton1Click:Connect(function()
                    local currentValue = library.flags[flag]
                    currentValue = math.clamp(currentValue - 1, min, max)
                    funcs:SetValue(currentValue)
                end)
                
                AddSlider.MouseButton1Click:Connect(function()
                    local currentValue = library.flags[flag]
                    currentValue = math.clamp(currentValue + 1, min, max)
                    funcs:SetValue(currentValue)
                end)
                
                funcs:SetValue(default)
                
                local dragging, boxFocused, allowed = false, false, { [""] = true, ["-"] = true }
                
                SliderBar.InputBegan:Connect(function(input)
                    if input.UserInputType == Enum.UserInputType.MouseButton1 then
                        funcs:SetValue()
                        dragging = true
                    end
                end)
                
                services.UserInputService.InputEnded:Connect(function(input)
                    if dragging and input.UserInputType == Enum.UserInputType.MouseButton1 then
                        dragging = false
                    end
                end)
                
                services.UserInputService.InputChanged:Connect(function(input)
                    if dragging and input.UserInputType == Enum.UserInputType.MouseMovement then
                        funcs:SetValue()
                    end
                end)
                
                SliderBar.InputBegan:Connect(function(input)
                    if input.UserInputType == Enum.UserInputType.Touch then
                        funcs:SetValue()
                        dragging = true
                    end
                end)
                
                services.UserInputService.InputEnded:Connect(function(input)
                    if dragging and input.UserInputType == Enum.UserInputType.Touch then
                        dragging = false
                    end
                end)
                
                services.UserInputService.InputChanged:Connect(function(input)
                    if dragging and input.UserInputType == Enum.UserInputType.Touch then
                        funcs:SetValue()
                    end
                end)
                
                SliderValue.Focused:Connect(function()
                    boxFocused = true
                end)
                
                SliderValue.FocusLost:Connect(function()
                    boxFocused = false
                    if SliderValue.Text == "" then
                        funcs:SetValue(default)
                    end
                end)
                
                SliderValue:GetPropertyChangedSignal("Text"):Connect(function()
                    if not boxFocused then
                        return
                    end
                    SliderValue.Text = SliderValue.Text:gsub("%D+", "")
                    local text = SliderValue.Text
                    if not tonumber(text) then
                        SliderValue.Text = SliderValue.Text:gsub("%D+", "")
                    elseif not allowed[text] then
                        if tonumber(text) > max then
                            text = max
                            SliderValue.Text = tostring(max)
                        end
                        funcs:SetValue(tonumber(text))
                    end
                end)
                
                return funcs
            end
            
            function section.Dropdown(section, text, flag, options, callback)
                local callback = callback or function() end
                local options = options or {}
                assert(text, "No text provided")
                assert(flag, "No flag provided")
                library.flags[flag] = nil
                
                local DropdownModule = Instance.new("Frame")
                local DropdownTop = Instance.new("TextButton")
                local DropdownTopC = Instance.new("UICorner")
                local DropdownOpen = Instance.new("TextButton")
                local DropdownText = Instance.new("TextBox")
                local DropdownModuleL = Instance.new("UIListLayout")
                local Option = Instance.new("TextButton")
                local OptionC = Instance.new("UICorner")
                
                DropdownModule.Name = "DropdownModule"
                DropdownModule.Parent = Objs
                DropdownModule.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
                DropdownModule.BackgroundTransparency = 1.000
                DropdownModule.BorderSizePixel = 0
                DropdownModule.ClipsDescendants = true
                DropdownModule.Position = UDim2.new(0, 0, 0, 0)
                DropdownModule.Size = UDim2.new(0, 428, 0, 38)
                
                -- ========== 修改下拉菜单顶部文本样式 ==========
                DropdownTop.Name = "DropdownTop"
                DropdownTop.Parent = DropdownModule
                DropdownTop.BackgroundColor3 = zyColor
                DropdownTop.BackgroundTransparency = zyColorTransparency  -- 半透明效果
                DropdownTop.BorderSizePixel = 0
                DropdownTop.Size = UDim2.new(0, 428, 0, 38)
                DropdownTop.AutoButtonColor = false
                DropdownTop.Font = Enum.Font.GothamBold  -- 更粗的字体
                DropdownTop.Text = ""
                DropdownTop.TextColor3 = Color3.fromRGB(255, 255, 255)
                DropdownTop.TextSize = 16.000
                DropdownTop.TextXAlignment = Enum.TextXAlignment.Left
                
                DropdownTopC.CornerRadius = UDim.new(0, 6)
                DropdownTopC.Name = "DropdownTopC"
                DropdownTopC.Parent = DropdownTop
                
                -- ========== 修改下拉展开按钮文本样式 ==========
                DropdownOpen.Name = "DropdownOpen"
                DropdownOpen.Parent = DropdownTop
                DropdownOpen.AnchorPoint = Vector2.new(0, 0.5)
                DropdownOpen.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
                DropdownOpen.BackgroundTransparency = 1.000
                DropdownOpen.BorderSizePixel = 0
                DropdownOpen.Position = UDim2.new(0.918383181, 0, 0.5, 0)
                DropdownOpen.Size = UDim2.new(0, 20, 0, 20)
                DropdownOpen.Font = Enum.Font.GothamBold  -- 更粗的字体
                DropdownOpen.Text = "+"
                DropdownOpen.TextColor3 = TextColor  -- 亮白色
                DropdownOpen.TextSize = 24.000
                DropdownOpen.TextTransparency = 0
                DropdownOpen.TextWrapped = true
                
                -- ========== 修改下拉菜单文本样式 ==========
                DropdownText.Name = "DropdownText"
                DropdownText.Parent = DropdownTop
                DropdownText.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
                DropdownText.BackgroundTransparency = 1.000
                DropdownText.BorderSizePixel = 0
                DropdownText.Position = UDim2.new(0.0373831764, 0, 0, 0)
                DropdownText.Size = UDim2.new(0, 184, 0, 38)
                DropdownText.Font = Enum.Font.GothamBold  -- 更粗的字体
                DropdownText.PlaceholderColor3 = PlaceholderColor
                DropdownText.PlaceholderText = text
                DropdownText.Text = ""
                DropdownText.TextColor3 = TextColor  -- 亮白色
                DropdownText.TextSize = 16.000
                DropdownText.TextTransparency = 0
                DropdownText.TextXAlignment = Enum.TextXAlignment.Left
                
                DropdownModuleL.Name = "DropdownModuleL"
                DropdownModuleL.Parent = DropdownModule
                DropdownModuleL.SortOrder = Enum.SortOrder.LayoutOrder
                DropdownModuleL.Padding = UDim.new(0, 4)
                
                local setAllVisible = function()
                    local options = DropdownModule:GetChildren()
                    for i = 1, #options do
                        local option = options[i]
                        if option:IsA("TextButton") and option.Name:match("Option_") then
                            option.Visible = true
                        end
                    end
                end
                
                local searchDropdown = function(text)
                    local options = DropdownModule:GetChildren()
                    for i = 1, #options do
                        local option = options[i]
                        if text == "" then
                            setAllVisible()
                        else
                            if option:IsA("TextButton") and option.Name:match("Option_") then
                                if option.Text:lower():match(text:lower()) then
                                    option.Visible = true
                                else
                                    option.Visible = false
                                end
                            end
                        end
                    end
                end
                
                local open = false
                local ToggleDropVis = function()
                    open = not open
                    if open then
                        setAllVisible()
                    end
                    DropdownOpen.Text = (open and "-" or "+")
                    DropdownModule.Size =
                        UDim2.new(0, 428, 0, (open and DropdownModuleL.AbsoluteContentSize.Y + 4 or 38))
                end
                
                DropdownOpen.MouseButton1Click:Connect(ToggleDropVis)
                
                DropdownText.Focused:Connect(function()
                    if open then
                        return
                    end
                    ToggleDropVis()
                end)
                
                DropdownText:GetPropertyChangedSignal("Text"):Connect(function()
                    if not open then
                        return
                    end
                    searchDropdown(DropdownText.Text)
                end)
                
                DropdownModuleL:GetPropertyChangedSignal("AbsoluteContentSize"):Connect(function()
                    if not open then
                        return
                    end
                    DropdownModule.Size = UDim2.new(0, 428, 0, (DropdownModuleL.AbsoluteContentSize.Y + 4))
                end)
                
                local funcs = {}
                
                funcs.AddOption = function(self, option)
                    local Option = Instance.new("TextButton")
                    local OptionC = Instance.new("UICorner")
                    
                    Option.Name = "Option_" .. option
                    Option.Parent = DropdownModule
                    Option.BackgroundColor3 = zyColor
                    Option.BackgroundTransparency = zyColorTransparency  -- 半透明效果
                    Option.BorderSizePixel = 0
                    Option.Position = UDim2.new(0, 0, 0.328125, 0)
                    Option.Size = UDim2.new(0, 428, 0, 26)
                    Option.AutoButtonColor = false
                    Option.Font = Enum.Font.GothamBold  -- 更粗的字体
                    Option.Text = option
                    Option.TextColor3 = TextColor  -- 亮白色
                    Option.TextSize = 14.000
                    Option.TextTransparency = 0
                    
                    OptionC.CornerRadius = UDim.new(0, 6)
                    OptionC.Name = "OptionC"
                    OptionC.Parent = Option
                    
                    Option.MouseButton1Click:Connect(function()
                        ToggleDropVis()
                        callback(Option.Text)
                        DropdownText.Text = Option.Text
                        library.flags[flag] = Option.Text
                    end)
                end
                
                funcs.RemoveOption = function(self, option)
                    local option = DropdownModule:FindFirstChild("Option_" .. option)
                    if option then
                        option:Destroy()
                    end
                end
                
                funcs.SetOptions = function(self, options)
                    for _, v in next, DropdownModule:GetChildren() do
                        if v.Name:match("Option_") then
                            v:Destroy()
                        end
                    end
                    for _, v in next, options do
                        funcs:AddOption(v)
                    end
                end
                
                funcs:SetOptions(options)
                return funcs
            end
            
            return section
        end
        return tab
    end
    
    return window
end


-- ========== 内嵌UI库结束 ==========

-- 使用内嵌UI库创建界面
local ui = library
local win = ui:new("人挤人中心")

-- 创建标签页
local UITab1 = win:Tab("公告",'7734068321')
local UITab2 = win:Tab("功能",'7734068321')
local UITab3 = win:Tab("大佛",'7734068321')
local UITab4 = win:Tab("透视",'7734068321')
local UITab5 = win:Tab("传送",'7734068321')
local UITab6 = win:Tab("功能2",'7734068321')

-- ===================== 公告标签页 =====================
local noticeSection = UITab1:section("公告", true)
noticeSection:Label("kismile制作")
noticeSection:Label("脚本测试中")
noticeSection:Label("禁止乱打")
noticeSection:Label("禁止乱打")
noticeSection:Label("禁止乱打")

-- ===================== 通用标签页 =====================
local generalSection = UITab2:section("通用", true)

-- 视角缩放
generalSection:Slider("视角缩放距离", "CameraZoom", 128, 128, 10000, false, function(Value)
    LocalPlayer.CameraMaxZoomDistance = Value
end)

-- 移速功能
getfenv().translateSpeed = 50  -- 默认速度
getfenv().translateConnection = nil

generalSection:Textbox("速度", "TranslateSpeed", "50", function(Value)
    local speed = tonumber(Value)
    if speed then
        getfenv().translateSpeed = speed
    end
end)

generalSection:Toggle("加速开关", "TranslateToggle", false, function(State)
    getfenv().translateAccelEnabled = State
    
    -- 断开原有连接
    if getfenv().translateConnection then
        getfenv().translateConnection:Disconnect()
        getfenv().translateConnection = nil
    end
    
    if State then
        -- 创建新连接
        getfenv().translateConnection = RunService.Heartbeat:Connect(function()
            local char = LocalPlayer.Character
            if not char then return end
            
            local humanoid = char:FindFirstChildOfClass("Humanoid")
            if not humanoid or humanoid.Health <= 0 then return end
            
            if humanoid.MoveDirection.Magnitude > 0 then
                local moveDirection = humanoid.MoveDirection
                local acceleration = moveDirection * (getfenv().translateSpeed or 50) / 30
                char:TranslateBy(acceleration)
            end
        end)
    end
end)

-- 快捷功能按钮
generalSection:Button("飞行", function()
    pcall(function()
        loadstring(game:HttpGet("https://raw.githubusercontent.com/ttker951-dot/y1/refs/heads/main/rf"))()
    end)
end)

generalSection:Button("减画质", function()
    pcall(function()
        loadstring(game:HttpGet("https://raw.githubusercontent.com/ttker951-dot/y1/refs/heads/main/rfb"))()
    end)
end)

generalSection:Button("移除岩浆", function()
    pcall(function()
        loadstring(game:HttpGet("https://raw.githubusercontent.com/ttker951-dot/y1/refs/heads/main/lava"))()
    end)
end)

generalSection:Button("移除雾", function()
    pcall(function()
        loadstring(game:HttpGet("https://raw.githubusercontent.com/ttker951-dot/y1/refs/heads/main/fog"))()
    end)
end)

-- ===================== 范围攻击标签页 =====================
local attackSection = UITab3:section("范围", true)

-- 快速攻击核心配置
local _ENV = (getgenv or getrenv or getfenv)()
local Settings = {AutoClick = true, ClickDelay = 0.3}
local _G = _G or getfenv(0)._G
_G.FastAttack = _G.FastAttack ~= nil and _G.FastAttack or true
-- Auto Haki配置
local AutoHakiEnabled = false
local autoHakiTask = nil

-- Auto Haki循环函数
local function startAutoHakiLoop()
    if autoHakiTask then
        task.cancel(autoHakiTask)
        autoHakiTask = nil
    end
    
    autoHakiTask = task.spawn(function()
        while AutoHakiEnabled do
            task.wait(0.2)
            if AutoHakiEnabled and LocalPlayer.Character and not LocalPlayer.Character:FindFirstChild("HasBuso") then
                pcall(function()
                    ReplicatedStorage.Remotes.CommF_:InvokeServer("Buso")
                end)
            end
        end
        autoHakiTask = nil
    end)
end

-- 角色重生时重启Auto Haki
LocalPlayer.CharacterAdded:Connect(function(newCharacter)
    if AutoHakiEnabled then
        task.wait(2) -- 等待角色完全加载
        startAutoHakiLoop()
    end
end)

-- 工具函数
local function SafeWaitForChild(parent, childName, timeout)
    timeout = timeout or 10
    local success, result = pcall(function() 
        return parent:WaitForChild(childName, timeout) 
    end)
    if not success or not result then 
        warn("未找到组件: " .. childName) 
    end
    return result
end

local function CheckAndGetCoreComponents()
    local Remotes, Modules, Net, RegisterAttack, RegisterHit, Enemies = nil, nil, nil, nil, nil, nil
    
    Remotes = SafeWaitForChild(ReplicatedStorage, "Remotes")
    Modules = SafeWaitForChild(ReplicatedStorage, "Modules")
    Net = Modules and SafeWaitForChild(Modules, "Net") or nil
    RegisterAttack = Net and SafeWaitForChild(Net, "RE/RegisterAttack") or nil
    RegisterHit = Net and SafeWaitForChild(Net, "RE/RegisterHit") or nil
    Enemies = SafeWaitForChild(Workspace, "Enemies")
    
    if Remotes and Modules and Net and RegisterAttack and RegisterHit and Enemies then
        return Remotes, Net, RegisterAttack, RegisterHit, Enemies
    end
    return nil
end

local function IsAlive(character)
    if not character then return false end
    local humanoid = character:FindFirstChildOfClass("Humanoid")
    return humanoid and humanoid.Health and humanoid.Health > 0
end

local function GetRandomValidPart(target)
    local allParts = target:GetDescendants()
    local validParts = {}
    local humanoidRootPart = target:FindFirstChild("HumanoidRootPart")
    local boneParts = humanoidRootPart and humanoidRootPart.Parent:GetDescendants() or {}
    
    for _, part in ipairs(allParts) do
        if part:IsA("BasePart") and part.CanCollide and table.find(boneParts, part) then
            table.insert(validParts, part)
        end
    end
    
    return #validParts > 0 and validParts[math.random(1, #validParts)] or target:FindFirstChild("HumanoidRootPart")
end

-- 快速攻击模块
local FastAttackModule = (function()
    if _ENV.rz_FastAttack then return _ENV.rz_FastAttack end
    
    local FastAttack = {
        Distance = 2500,
        attackMobs = true,
        attackPlayers = true,
        Equipped = nil,
        IsRunning = _G.FastAttack,
        consecutiveFailures = 0,
        maxConsecutiveFailures = 5
    }

    local function ProcessEnemies(OthersEnemies, Folder)
        if not Folder or not FastAttack.attackMobs then return nil end
        local BasePart = nil
        
        for _, Enemy in Folder:GetChildren() do
            if Enemy == LocalPlayer.Character or not IsAlive(Enemy) then continue end
            local foundPart = GetRandomValidPart(Enemy)
            
            if foundPart and LocalPlayer:DistanceFromCharacter(foundPart.Position) < FastAttack.Distance then
                table.insert(OthersEnemies, {Enemy, foundPart})
                BasePart = foundPart
            end
        end
        return BasePart
    end

    local function ProcessRealPlayers(OthersEnemies)
        if not FastAttack.attackPlayers then return nil end
        local BasePart = nil
        
        for _, OtherPlayer in Players:GetPlayers() do
            if OtherPlayer == LocalPlayer then continue end
            local OtherChar = OtherPlayer.Character
            
            if not IsAlive(OtherChar) then continue end
            local foundPart = GetRandomValidPart(OtherChar)
            
            if foundPart and LocalPlayer:DistanceFromCharacter(foundPart.Position) < FastAttack.Distance then
                table.insert(OthersEnemies, {OtherChar, foundPart})
                BasePart = foundPart
            end
        end
        return BasePart
    end

    function FastAttack:Attack(BasePart, OthersEnemies)
        local components = {CheckAndGetCoreComponents()}
        local Net, temp_RegisterAttack, temp_RegisterHit = components[2], components[3], components[4]
        
        if not (BasePart and OthersEnemies and #OthersEnemies > 0 and temp_RegisterAttack and temp_RegisterHit) then
            self.consecutiveFailures = self.consecutiveFailures + 1
            
            if self.consecutiveFailures >= self.maxConsecutiveFailures then
                self.consecutiveFailures = 0
                self.Equipped = LocalPlayer.Character and IsAlive(LocalPlayer.Character) and LocalPlayer.Character:FindFirstChildOfClass("Tool")
            end
            
            task.delay(0.5, function() self:AttackNearest() end)
            return
        end
        
        self.consecutiveFailures = 0
        temp_RegisterAttack:FireServer(Settings.ClickDelay or 0)
        temp_RegisterHit:FireServer(BasePart, OthersEnemies)
    end

    function FastAttack:AttackNearest()
        if not self.IsRunning then return end
        local components = {CheckAndGetCoreComponents()}
        local Enemies = components[5]
        local OthersEnemies = {}
        
        local Part1 = ProcessEnemies(OthersEnemies, Enemies)
        local Part2 = ProcessRealPlayers(OthersEnemies)
        
        if #OthersEnemies > 0 then
            self:Attack(Part1 or Part2, OthersEnemies)
        end
    end

    function FastAttack:BladeHits()
        if not self.IsRunning then return end
        local Equipped = LocalPlayer.Character and IsAlive(LocalPlayer.Character) and LocalPlayer.Character:FindFirstChildOfClass("Tool")
        
        if Equipped and Equipped.ToolTip ~= "Gun" then
            self:AttackNearest()
        end
    end

    -- 攻击循环
    task.spawn(function()
        while true do
            task.wait(Settings.ClickDelay)
            if Settings.AutoClick and FastAttack.IsRunning then
                FastAttack:BladeHits()
            else
                task.wait(0.1)
            end
        end
    end)

    _ENV.rz_FastAttack = FastAttack
    return FastAttack
end)()

-- 范围攻击UI绑定
attackSection:Toggle("攻击开关", "FastAttackToggle", _G.FastAttack, function(state)
    if _ENV.rz_FastAttack then
        _ENV.rz_FastAttack.IsRunning = state
        _G.FastAttack = state
    end
end)

attackSection:Textbox("攻击范围", "AttackRange", "2500", function(text)
    local num = tonumber(text) or 2500
    num = math.floor(math.clamp(num, 1, 2500))
    if _ENV.rz_FastAttack then
        _ENV.rz_FastAttack.Distance = num
    end
end)

attackSection:Textbox("攻击速度", "ClickDelay", "0.3", function(text)
    local num = tonumber(text) or 0.3
    num = math.round(math.clamp(num, 0.05, 2) * 100) / 100
    Settings.ClickDelay = num
end)

attackSection:Toggle("攻击怪物", "AttackMobsToggle", true, function(state)
    if _ENV.rz_FastAttack then
        _ENV.rz_FastAttack.attackMobs = state
    end
end)

attackSection:Toggle("攻击玩家", "AttackPlayersToggle", true, function(state)
    if _ENV.rz_FastAttack then
        _ENV.rz_FastAttack.attackPlayers = state
    end
end)

-- 自动V4功能
local toggleKey = "自动v4"
local autoV4Task = nil

-- 初始化全局开关状态
if not _G.ToggleStates then
    _G.ToggleStates = {}
end

local function getToggleState(key)
    return _G.ToggleStates[key] or false
end

local function callAwakeningRemote()
    local character = LocalPlayer.Character
    if not character then return end
    
    local humanoid = character:FindFirstChildOfClass("Humanoid")
    if not humanoid or humanoid.Health <= 0 then return end

    local Backpack = LocalPlayer:FindFirstChild("Backpack")
    if not Backpack then return end
    
    local Awakening = Backpack:FindFirstChild("Awakening")
    if not Awakening then return end
    
    local RemoteFunc = Awakening:FindFirstChild("RemoteFunction")
    if not RemoteFunc or not RemoteFunc:IsA("RemoteFunction") then return end
    
    local success, err = pcall(function()
        RemoteFunc:InvokeServer(true)
    end)
    if not success then
        warn("自动v4调用失败：", err)
    end
end

local function runAutoV4Loop()
    if autoV4Task then
        task.cancel(autoV4Task)
        autoV4Task = nil
    end

    autoV4Task = task.spawn(function()
        while getToggleState(toggleKey) do
            callAwakeningRemote()
            task.wait(1)
        end
        autoV4Task = nil
    end)
end

local function toggleAutoV4(enable)
    if autoV4Task then
        task.cancel(autoV4Task)
        autoV4Task = nil
    end

    if enable then
        runAutoV4Loop()
    end
end

-- 角色重生时重启自动V4
LocalPlayer.CharacterAdded:Connect(function(newCharacter)
    newCharacter:WaitForChild("Humanoid")
    if getToggleState(toggleKey) then
        toggleAutoV4(true)
    end
end)

-- 自动V4 UI绑定
attackSection:Toggle(toggleKey, "AutoV4Toggle", false, function(IsEnabled)
    _G.ToggleStates[toggleKey] = IsEnabled
    toggleAutoV4(IsEnabled)
end)

-- 自动V3功能
local toggleKeyV3 = "自动v3"
local autoV3Task = nil

local function callRaceV3Remote()
    local character = LocalPlayer.Character
    if not character then return end
    
    local humanoid = character:FindFirstChildOfClass("Humanoid")
    if not humanoid or humanoid.Health <= 0 then return end

    local ReplicatedStorage = game:GetService("ReplicatedStorage")
    local Remotes = ReplicatedStorage:FindFirstChild("Remotes")
    if not Remotes then return end
    
    local CommE = Remotes:FindFirstChild("CommE")
    if not CommE or not CommE:IsA("RemoteEvent") then return end
    
    local success, err = pcall(function()
        CommE:FireServer("ActivateAbility")
    end)
    if not success then
        warn("自动v3调用失败：", err)
    end
end

local function runAutoV3Loop()
    if autoV3Task then
        task.cancel(autoV3Task)
        autoV3Task = nil
    end

    autoV3Task = task.spawn(function()
        while getToggleState(toggleKeyV3) do
            callRaceV3Remote()
            task.wait(1)
        end
        autoV3Task = nil
    end)
end

local function toggleAutoV3(enable)
    if autoV3Task then
        task.cancel(autoV3Task)
        autoV3Task = nil
    end

    if enable then
        runAutoV3Loop()
    end
end

-- 角色重生时重启自动V3
LocalPlayer.CharacterAdded:Connect(function(newCharacter)
    newCharacter:WaitForChild("Humanoid")
    if getToggleState(toggleKeyV3) then
        toggleAutoV3(true)
    end
end)

-- 自动V3 UI绑定
attackSection:Toggle(toggleKeyV3, "AutoV3Toggle", false, function(IsEnabled)
    _G.ToggleStates[toggleKeyV3] = IsEnabled
    toggleAutoV3(IsEnabled)
end)

attackSection:Toggle("自动武装色", "AutoHakiToggle", true, function(state)
    AutoHakiEnabled = state
    if state then
        startAutoHakiLoop()
        warn("[自动武装色] 功能已开启")
    else
        if autoHakiTask then
            task.cancel(autoHakiTask)
            autoHakiTask = nil
        end
        warn("[自动武装色] 功能已关闭")
    end
end)

-- ===================== 快速攻击组件恢复逻辑 =====================
task.spawn(function()
    while true do
        task.wait(1)
        if not _ENV.rz_FastAttack and _G.FastAttack then
            warn("快速攻击组件未完全加载 尝试恢复...")
            FastAttackModule = FastAttackModule or (function()
                local FastAttack = {
                    Distance=2500,
                    attackMobs=true,
                    attackPlayers=true,
                    Equipped=nil,
                    IsRunning=_G.FastAttack,
                    consecutiveFailures=0,
                    maxConsecutiveFailures=5
                }
                _ENV.rz_FastAttack = FastAttack
                return FastAttack
            end)()
        end
    end
end)

-- ===================== 透视标签页 =====================
local espSection = UITab4:section("透视", true)

-- 透视配置
local ESPConfig = {
    MainSwitch = false,     
    ShowNameDistance = false, 
    ShowTracer = false,       
    ShowHealth = false        
}

local ESPElements = {}

-- 清理玩家ESP元素
local function CleanupPlayerESP(player)
    if not ESPElements[player.UserId] then return end
    
    if ESPElements[player.UserId].NameHealthESP then
        ESPElements[player.UserId].NameHealthESP:Destroy()
        ESPElements[player.UserId].NameHealthESP = nil
    end
    if ESPElements[player.UserId].NameHealthUpdateConn then
        ESPElements[player.UserId].NameHealthUpdateConn:Disconnect()
        ESPElements[player.UserId].NameHealthUpdateConn = nil
    end
    
    if ESPElements[player.UserId].Tracer then
        ESPElements[player.UserId].Tracer:Remove()
        ESPElements[player.UserId].Tracer = nil
    end
    if ESPElements[player.UserId].TracerConn then
        ESPElements[player.UserId].TracerConn:Disconnect()
        ESPElements[player.UserId].TracerConn = nil
    end
end

-- 创建名字/距离/血量ESP
local function CreateNameDistanceHealthESP(player)
    if not player.Character or not player.Character:FindFirstChild("Head") then return end
    local head = player.Character.Head
    
    if ESPElements[player.UserId] and ESPElements[player.UserId].NameHealthESP then
        ESPElements[player.UserId].NameHealthESP:Destroy()
    end
    
    local billboardGui = Instance.new("BillboardGui")
    billboardGui.Name = "NameDistanceHealthESP"
    billboardGui.Adornee = head
    billboardGui.Size = UDim2.new(0, 120, 0, 50)
    billboardGui.StudsOffset = Vector3.new(0, 3.5, 0)
    billboardGui.AlwaysOnTop = true
    billboardGui.Parent = head
    
    local nameLabel = Instance.new("TextLabel")
    nameLabel.Parent = billboardGui
    nameLabel.BackgroundTransparency = 1
    nameLabel.Text = player.Name
    nameLabel.Size = UDim2.new(1, 0, 0.33, 0)
    nameLabel.TextColor3 = Color3.new(1, 1, 1)
    nameLabel.TextScaled = true 
    nameLabel.Font = Enum.Font.GothamSemibold
    
    local healthLabel = Instance.new("TextLabel")
    healthLabel.Parent = billboardGui
    healthLabel.BackgroundTransparency = 1
    healthLabel.Position = UDim2.new(0, 0, 0.33, 0)
    healthLabel.Size = UDim2.new(1, 0, 0.33, 0)
    healthLabel.TextColor3 = Color3.new(0, 1, 0)
    healthLabel.TextScaled = true 
    healthLabel.Font = Enum.Font.Gotham
    
    local distanceLabel = Instance.new("TextLabel")
    distanceLabel.Parent = billboardGui
    distanceLabel.BackgroundTransparency = 1
    distanceLabel.Position = UDim2.new(0, 0, 0.66, 0)
    distanceLabel.Size = UDim2.new(1, 0, 0.33, 0)
    distanceLabel.TextColor3 = Color3.new(1, 0.5, 0)
    distanceLabel.TextScaled = true
    distanceLabel.Font = Enum.Font.Gotham
    
    local updateConnection = RunService.RenderStepped:Connect(function()
        if not billboardGui.Parent or not LocalPlayer.Character or not player.Character then 
            return 
        end
        
        local localRoot = LocalPlayer.Character:FindFirstChild("HumanoidRootPart")
        local targetRoot = player.Character:FindFirstChild("HumanoidRootPart")
        if localRoot and targetRoot then
            local distance = (localRoot.Position - targetRoot.Position).Magnitude
            distanceLabel.Text = string.format("%.1f米", distance)   
        end
        
        local humanoid = player.Character:FindFirstChild("Humanoid")
        if humanoid then
            local health = math.floor(humanoid.Health)
            local maxHealth = math.floor(humanoid.MaxHealth)
            
            local healthPercent = health / maxHealth
            if healthPercent > 0.7 then
                healthLabel.TextColor3 = Color3.new(0, 1, 0)
            elseif healthPercent > 0.3 then
                healthLabel.TextColor3 = Color3.new(1, 1, 0)
            else
                healthLabel.TextColor3 = Color3.new(1, 0, 0)
            end
            
            healthLabel.Text = string.format("血量: %d/%d", health, maxHealth)
        end
    end)
    
    ESPElements[player.UserId] = ESPElements[player.UserId] or {}
    ESPElements[player.UserId].NameHealthESP = billboardGui
    ESPElements[player.UserId].NameHealthUpdateConn = updateConnection
end

-- 创建射线ESP
local function CreateTracerESP(player)
    if ESPElements[player.UserId] and ESPElements[player.UserId].Tracer then
        ESPElements[player.UserId].Tracer:Remove()
    end
    
    local tracer = Drawing.new("Line")
    tracer.Color = Color3.new(1, 0, 0)
    tracer.Thickness = 2
    tracer.Transparency = 0.8
    tracer.Visible = false
    
    local renderConnection = RunService.RenderStepped:Connect(function()
        if not ESPConfig.MainSwitch or not ESPConfig.ShowTracer then
            tracer.Visible = false
            return
        end
        
        local localChar = LocalPlayer.Character
        local targetChar = player.Character
        if not localChar or not targetChar then
            tracer.Visible = false
            return
        end
        
        local targetRoot = targetChar:FindFirstChild("HumanoidRootPart")
        if targetRoot then
            local screenPos, isVisible = Camera:WorldToViewportPoint(targetRoot.Position)
            if isVisible then
                tracer.Visible = true
                tracer.From = Vector2.new(Camera.ViewportSize.X / 2, Camera.ViewportSize.Y / 2)
                tracer.To = Vector2.new(screenPos.X, screenPos.Y)
            else
                tracer.Visible = false
            end
        else
            tracer.Visible = false
        end
    end)
    
    ESPElements[player.UserId] = ESPElements[player.UserId] or {}
    ESPElements[player.UserId].Tracer = tracer
    ESPElements[player.UserId].TracerConn = renderConnection
end

-- 更新玩家ESP
local function UpdatePlayerESP(player)
    if player == LocalPlayer then return end
    
    if not player.Character or not player.Character:FindFirstChild("Head") or not player.Character:FindFirstChild("HumanoidRootPart") then
        CleanupPlayerESP(player)
        return
    end
    
    if ESPConfig.MainSwitch then
        CreateTracerESP(player)
        
        if ESPConfig.ShowNameDistance or ESPConfig.ShowHealth then
            CreateNameDistanceHealthESP(player)
        else
            CleanupPlayerESP(player)
        end
    else
        CleanupPlayerESP(player)
    end
end

-- 更新所有玩家ESP
local function UpdateAllESP()
    for _, player in pairs(Players:GetPlayers()) do
        if player ~= LocalPlayer then
            UpdatePlayerESP(player)
        end
    end
end

-- 处理玩家重生
local function HandlePlayerRespawn(player)
    local character = player.Character or player.CharacterAdded:Wait()
    
    local head = character:WaitForChild("Head", 5)
    local rootPart = character:WaitForChild("HumanoidRootPart", 5)
    local humanoid = character:WaitForChild("Humanoid", 5)
    
    if head and rootPart and humanoid then
        task.wait(0.5)
        UpdatePlayerESP(player)
    end
end

-- 玩家加入处理
Players.PlayerAdded:Connect(function(player)
    if player == LocalPlayer then return end
    
    if player.Character then
        task.spawn(HandlePlayerRespawn, player)
    end
    
    player.CharacterAdded:Connect(function()
        task.spawn(HandlePlayerRespawn, player)
    end)
    
    player.CharacterRemoving:Connect(function()
        CleanupPlayerESP(player)
    end)
end)

-- 本地玩家重生时更新所有ESP
LocalPlayer.CharacterAdded:Connect(function()
    task.wait(1)
    UpdateAllESP()
end)

-- 定期更新ESP
task.spawn(function()
    while true do
        task.wait(3)
        if ESPConfig.MainSwitch then
            UpdateAllESP()
        end
    end
end)

-- 透视UI绑定
espSection:Toggle("透视总开关", "ESP_Main", false, function(enabled)
    ESPConfig.MainSwitch = enabled
    UpdateAllESP()
end)

espSection:Toggle("显示玩家名字+距离", "ESP_NameDistance", false, function(enabled)
    ESPConfig.ShowNameDistance = enabled
    UpdateAllESP()
end)

espSection:Toggle("显示玩家血量", "ESP_Health", false, function(enabled)
    ESPConfig.ShowHealth = enabled
    UpdateAllESP()
end)

espSection:Toggle("射线追踪（屏幕中心）", "ESP_Tracer", false, function(enabled)
    ESPConfig.ShowTracer = enabled
    UpdateAllESP()
end)

-- ===================== 传送标签页 =====================
local tpMainSection = UITab5:section("传送", false)

-- 海域传送
tpMainSection:Button("传送至一海", function()
    pcall(function()
        ReplicatedStorage.Remotes.CommF_:InvokeServer("TravelMain")
    end)
end)

tpMainSection:Button("传送至二海", function()
    pcall(function()
        ReplicatedStorage.Remotes.CommF_:InvokeServer("TravelDressrosa")
    end)
end)

tpMainSection:Button("传送至三海", function()
    pcall(function()
        ReplicatedStorage.Remotes.CommF_:InvokeServer("TravelZou")
    end)
end)

-- 二海传送点
local tp2Section = UITab5:section("二海", false)
tp2Section:Button("传送至天鹅的房间", function()
    local char = LocalPlayer.Character
    if char and char:FindFirstChild("HumanoidRootPart") then
        char.HumanoidRootPart.CFrame = CFrame.new(-287.37, 305.81, 592.98)
    end
end)

tp2Section:Button("传送至豪宅", function()
    local char = LocalPlayer.Character
    if char and char:FindFirstChild("HumanoidRootPart") then
        char.HumanoidRootPart.CFrame = CFrame.new(2286.93, 15.06, 910.51)
    end
end)

tp2Section:Button("传送至鬼船里", function()
    local char = LocalPlayer.Character
    if char and char:FindFirstChild("HumanoidRootPart") then
        char.HumanoidRootPart.CFrame = CFrame.new(-6501.06, 83.11, -123.52)
    end
end)

tp2Section:Button("传送至鬼船外", function()
    local char = LocalPlayer.Character
    if char and char:FindFirstChild("HumanoidRootPart") then
        char.HumanoidRootPart.CFrame = CFrame.new(922.78, 123.96, 32842.40)
    end
end)

-- 三海传送点
local tp3Section = UITab5:section("三海", false)
tp3Section:Button("传送至海洋城堡", function()
    local char = LocalPlayer.Character
    if char and char:FindFirstChild("HumanoidRootPart") then
        char.HumanoidRootPart.CFrame = CFrame.new(-12463.60, 376.26, -7566.08)
    end
end)

tp3Section:Button("传送至海龟豪宅", function()
    local char = LocalPlayer.Character
    if char and char:FindFirstChild("HumanoidRootPart") then
        char.HumanoidRootPart.CFrame = CFrame.new(-5060.41, 316.43, -3192.30)
    end
end)

tp3Section:Button("传送至司法", function()
    local char = LocalPlayer.Character
    if char and char:FindFirstChild("HumanoidRootPart") then
        char.HumanoidRootPart.CFrame = CFrame.new(-5096.48, 316.43, -3177.91)
    end
end)

tp3Section:Button("传送至九头蛇", function()
    local char = LocalPlayer.Character
    if char and char:FindFirstChild("HumanoidRootPart") then
        char.HumanoidRootPart.CFrame = CFrame.new(-5027.03, 316.43, -3206.07)
    end
end)

-- ===================== 活动标签页（新增自动开佛拿刀） =====================
local activitySection = UITab6:section("功能", true)

-- 初始化全局设置（果实相关）
if not _G.Settings then
    _G.Settings = {
        Fruit = {
            ["Auto Buy Candy Fruit"] = false,
            ["Auto Store Fruit"] = false
        }
    }
end

-- 初始化保存设置函数
if not getgenv().SaveSetting then
    getgenv().SaveSetting = function()
    end
end

-- 果实名称映射表（完整列表）
local FruitMapping = {
    {"Rocket Fruit", "Rocket-Rocket"},
    {"Spin Fruit", "Spin-Spin"},
    {"Blade Fruit", "Blade-Blade"},
    {"Spring Fruit", "Spring-Spring"},
    {"Bomb Fruit", "Bomb-Bomb"},
    {"Smoke Fruit", "Smoke-Smoke"},
    {"Spike Fruit", "Spike-Spike"},
    {"Flame Fruit", "Flame-Flame"},
    {"Eagle Fruit", "Eagle-Eagle"},
    {"Ice Fruit", "Ice-Ice"},
    {"Sand Fruit", "Sand-Sand"},
    {"Dark Fruit", "Dark-Dark"},
    {"Diamond Fruit", "Diamond-Diamond"},
    {"Light Fruit", "Light-Light"},
    {"Rubber Fruit", "Rubber-Rubber"},
    {"Creation Fruit", "Creation-Creation"},
    {"Ghost Fruit", "Ghost-Ghost"},
    {"Magma Fruit", "Magma-Magma"},
    {"Quake Fruit", "Quake-Quake"},
    {"Buddha Fruit", "Buddha-Buddha"},
    {"Love Fruit", "Love-Love"},
    {"Spider Fruit", "Spider-Spider"},
    {"Sound Fruit", "Sound-Sound"},
    {"Phoenix Fruit", "Phoenix-Phoenix"},
    {"Portal Fruit", "Portal-Portal"},
    {"Lightning Fruit", "Lightning-Lightning"},
    {"Pain Fruit", "Pain-Pain"},
    {"Blizzard Fruit", "Blizzard-Blizzard"},
    {"Gravity Fruit", "Gravity-Gravity"},
    {"Mammoth Fruit", "Mammoth-Mammoth"},
    {"T-Rex Fruit", "T-Rex-T-Rex"},
    {"Dough Fruit", "Dough-Dough"},
    {"Shadow Fruit", "Shadow-Shadow"},
    {"Venom Fruit", "Venom-Venom"},
    {"Gas Fruit", "Gas-Gas"},
    {"Control Fruit", "Control-Control"},
    {"Spirit Fruit", "Spirit-Spirit"},
    {"Leopard Fruit", "Leopard-Leopard"},
    {"Yeti Fruit", "Yeti-Yeti"},
    {"Kitsune Fruit", "Kitsune-Kitsune"},
    {"Dragon Fruit", "Dragon-Dragon"}
}

-- 1. 自动用糖果抽果实功能
local AutoCandyFruitToggle = activitySection:Toggle("自动用糖果抽果实", "AutoCandyFruitToggle", _G.Settings.Fruit["Auto Buy Candy Fruit"] or false, function(state)
    _G.Settings.Fruit["Auto Buy Candy Fruit"] = state;
    getgenv().SaveSetting()
    if state then
        warn("[自动抽果实] 功能已开启")
    else
        warn("[自动抽果实] 功能已关闭")
    end
end);

task.spawn(function()
    while true do
        task.wait(0.5)
        pcall(function()
            if _G.Settings.Fruit["Auto Buy Candy Fruit"] then
                local CommF_Remote = game:GetService("ReplicatedStorage"):WaitForChild("Remotes"):WaitForChild("CommF_", 5)
                if CommF_Remote and math.random(1, 5) == 1 then
                    local checkArgs = {"Cousin", "CheckCanBuyType", "F2PXmasWeek2Gacha25"}
                    CommF_Remote:InvokeServer(unpack(checkArgs))
                end

                if CommF_Remote then
                    local drawArgs = {"Cousin", "F2PXmasWeek2Gacha25"}
                    CommF_Remote:InvokeServer(unpack(drawArgs))
                end

                local GetIsComingSoon_Remote = game:GetService("ReplicatedStorage"):WaitForChild("Remotes"):WaitForChild("GetIsComingSoon", 5)
                if GetIsComingSoon_Remote and math.random(1, 10) == 1 then
                    GetIsComingSoon_Remote:InvokeServer()
                end
            end
        end)
    end
end);

-- 2. 修复版自动存储果实功能
local AutoStoreFruitToggle = activitySection:Toggle("自动存储果实", "AutoStoreFruitToggle", _G.Settings.Fruit["Auto Store Fruit"] or false, function(state)
    _G.Settings.Fruit["Auto Store Fruit"] = state;
    getgenv().SaveSetting();
    getgenv().AutoStoreFruit = state
    if state then
        warn("[自动存储果实] 功能已开启")
    else
        warn("[自动存储果实] 功能已关闭")
    end
end);

-- 自动存储核心循环（修复版）
task.spawn(function()
    while true do
        task.wait(0.2)
        if not getgenv().AutoStoreFruit then
            continue
        end

        local success, err = pcall(function()
            local LocalPlayer = game:GetService("Players").LocalPlayer
            if not LocalPlayer then return end

            local Character = LocalPlayer.Character or LocalPlayer.CharacterAdded:Wait()
            if not Character then return end

            local Backpack = LocalPlayer:WaitForChild("Backpack", 5)
            if not Backpack then
                warn("[自动存储] 背包加载超时")
                return
            end

            local Remotes = game:GetService("ReplicatedStorage"):WaitForChild("Remotes", 5)
            local CommF_Remote = Remotes and Remotes:WaitForChild("CommF_", 5)
            if not CommF_Remote then
                warn("[自动存储] 未找到CommF_远程函数")
                return
            end

            for _, fruitData in ipairs(FruitMapping) do
                local fruitName = fruitData[1]
                local fruitKey = fruitData[2]

                local fruitObj = Backpack:FindFirstChild(fruitName) or Character:FindFirstChild(fruitName)
                if fruitObj then
                    local callSuccess, callErr = pcall(function()
                        CommF_Remote:InvokeServer("StoreFruit", fruitKey, fruitObj)
                    end)

                    if callSuccess then
                        warn("[自动存储] 成功存储：", fruitName)
                        task.wait(0.1)
                        if fruitObj.Parent then
                            fruitObj:Destroy()
                        end
                        break
                    else
                        warn("[自动存储] 存储失败：", fruitName, "错误：", callErr)
                        local simpleArgs = {"StoreFruit", fruitKey:gsub("-", "")}
                        pcall(function()
                            CommF_Remote:InvokeServer(unpack(simpleArgs))
                            warn("[自动存储] 使用简化参数存储成功：", fruitName)
                        end)
                    end
                end
            end
        end)

        if not success then
            warn("[自动存储] 执行出错：", err)
        end
    end
end)

-- ===================== 新增：自动开佛拿刀功能 =====================
-- 配置
local AUTO_BUDDHA_ENABLED = false
local CHECK_INTERVAL = 5
local BUDDHA_SLOT = 2
local SWORD_SLOT = 3
local BUDDHA_MIN_SIZE = 20.0

-- 所有刀具的列表
local ALL_SWORDS = {
    "True Triple Katana",
    "Hallow Scythe", 
    "Dark Blade",
    "Cursed Dual Katana",
    "Rengoku",
    "Saber",
    "Saishi",
    "Shark Anchor",
    "Spikey Trident",
    "Tushita",
    "Yama",
    "Dragonheart"
}

-- 将刀具列表转换为表以便快速查找
local SWORDS_TABLE = {}
for _, sword in ipairs(ALL_SWORDS) do
    SWORDS_TABLE[sword] = true
end

-- 检测Buddha形态
local function isBuddhaForm()
    local character = LocalPlayer.Character
    if not character then return false end
    
    local humanoidRootPart = character:FindFirstChild("HumanoidRootPart")
    if not humanoidRootPart then return false end
    
    local sizeMagnitude = humanoidRootPart.Size.Magnitude
    return sizeMagnitude > BUDDHA_MIN_SIZE
end

-- 按下数字键切换栏位
local function pressNumberKey(number)
    local virtualInput = game:GetService("VirtualInputManager")
    local keyCode
    
    if number == 1 then keyCode = Enum.KeyCode.One
    elseif number == 2 then keyCode = Enum.KeyCode.Two
    elseif number == 3 then keyCode = Enum.KeyCode.Three
    elseif number == 4 then keyCode = Enum.KeyCode.Four
    elseif number == 5 then keyCode = Enum.KeyCode.Five
    elseif number == 6 then keyCode = Enum.KeyCode.Six
    elseif number == 7 then keyCode = Enum.KeyCode.Seven
    elseif number == 8 then keyCode = Enum.KeyCode.Eight
    else keyCode = Enum.KeyCode.Nine end
    
    virtualInput:SendKeyEvent(true, keyCode, false, nil)
    task.wait(0.05)
    virtualInput:SendKeyEvent(false, keyCode, false, nil)
end

-- 按下Z键
local function pressZKey()
    local virtualInput = game:GetService("VirtualInputManager")
    
    virtualInput:SendKeyEvent(true, Enum.KeyCode.Z, false, nil)
    task.wait(0.1)
    virtualInput:SendKeyEvent(false, Enum.KeyCode.Z, false, nil)
end

-- 检查是否持有任何刀
local function hasAnySwordEquipped()
    local character = LocalPlayer.Character
    if not character then return false end
    
    for _, child in ipairs(character:GetChildren()) do
        if child:IsA("Tool") and SWORDS_TABLE[child.Name] then
            return true, child.Name
        end
    end
    
    return false, nil
end

-- 获取当前装备的刀名
local function getEquippedSwordName()
    local character = LocalPlayer.Character
    if not character then return nil end
    
    for _, child in ipairs(character:GetChildren()) do
        if child:IsA("Tool") and SWORDS_TABLE[child.Name] then
            return child.Name
        end
    end
    
    return nil
end

-- 装备刀
local function equipSword()
    -- 先切换到刀的栏位
    pressNumberKey(SWORD_SLOT)
    task.wait(0.3)
    
    -- 检查是否已经装备
    local hasSword, swordName = hasAnySwordEquipped()
    if hasSword then
        return true, swordName
    end
    
    -- 检查是否装备成功
    task.wait(0.5)
    return hasAnySwordEquipped()
end

-- 变身Buddha
local function performBuddhaTransformation()
    local character = LocalPlayer.Character
    if not character then
        return false
    end
    
    -- 切换到Buddha工具
    pressNumberKey(BUDDHA_SLOT)
    task.wait(0.5)
    
    -- 按Z键变身
    pressZKey()
    
    -- 等待并检查变身结果
    local waitTime = 0
    local maxWaitTime = 3
    
    while waitTime < maxWaitTime do
        task.wait(0.1)
        waitTime = waitTime + 0.1
        
        if isBuddhaForm() then
            return true
        end
    end
    
    return false
end

-- 自动开佛拿刀主循环
local buddhaTask = nil
local function startBuddhaLoop()
    if buddhaTask then
        task.cancel(buddhaTask)
        buddhaTask = nil
    end
    
    buddhaTask = task.spawn(function()
        local lastCheckTime = 0
        
        while AUTO_BUDDHA_ENABLED do
            task.wait(1)
            
            local currentTime = tick()
            if currentTime - lastCheckTime >= CHECK_INTERVAL then
                lastCheckTime = currentTime
                
                if not LocalPlayer.Character then
                    -- 等待角色
                else
                    if isBuddhaForm() then
                        -- 检查并装备刀
                        local hasSword, swordName = hasAnySwordEquipped()
                        if not hasSword then
                            equipSword()
                        end
                    else
                        -- 执行变身
                        local success = performBuddhaTransformation()
                        
                        if success then
                            -- 变身后装备刀
                            task.wait(0.5)
                            local hasSword, swordName = hasAnySwordEquipped()
                            if not hasSword then
                                equipSword()
                            end
                        end
                    end
                end
            end
        end
        buddhaTask = nil
    end)
end

LocalPlayer.CharacterAdded:Connect(function()
    if AUTO_BUDDHA_ENABLED then
        task.wait(2)
        startBuddhaLoop()
    end
end)

-- 自动开佛拿刀开关
local autoBuddhaToggle = activitySection:Toggle("自动变身大佛＋拿刀", "AutoBuddhaToggle", false, function(state)
    AUTO_BUDDHA_ENABLED = state
    if state then
        startBuddhaLoop()
        warn("[自动变佛＋拿刀] 功能已开启 - 支持所有刀具")
    else
        if buddhaTask then
            task.cancel(buddhaTask)
            buddhaTask = nil
        end
        warn("[自动变佛＋拿刀] 功能已关闭")
    end
end)



activitySection:Button("自动地下城", function()
    pcall(function()
        loadstring(game:HttpGet("https://raw.githubusercontent.com/ttker951-dot/y1/refs/heads/main/at%20fb"))()
    end)
end)


task.spawn(function()
    task.wait(2)
    UpdateAllESP()
end)

-- 加载完成提示
game:GetService("StarterGui"):SetCore("SendNotification",{
    Title = "人挤人脚本",
    Text = "加载完成 祝您使用愉快",
    Duration = 5;
})
